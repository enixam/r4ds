<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>1.6 Exercises | R for data science: tidyverse and beyond</title>
  <meta name="description" content="1.6 Exercises | R for data science: tidyverse and beyond" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="1.6 Exercises | R for data science: tidyverse and beyond" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="enixam/rfordatascience" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="1.6 Exercises | R for data science: tidyverse and beyond" />
  
  
  

<meta name="author" content="Maxine" />


<meta name="date" content="2020-05-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="group-by-combined-with-other-functions.html"/>
<link rel="next" href="tibble-modern-data-frames.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/jsoneditor-5.25.6/jsoneditor.min.css" rel="stylesheet" />
<script src="libs/jsoneditor-5.25.6/jsoneditor.min.js"></script>
<script src="libs/jsonedit-binding-3.0.0/jsonedit.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css\style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R4DS: tidyverse and beyond</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>前言</a></li>
<li class="part"><span><b>I R for data science</b></span></li>
<li class="chapter" data-level="1" data-path="dplyr-data-transformation.html"><a href="dplyr-data-transformation.html"><i class="fa fa-check"></i><b>1</b> dplyr: Data transformation</a><ul>
<li class="chapter" data-level="1.1" data-path="filter.html"><a href="filter.html"><i class="fa fa-check"></i><b>1.1</b> <code>filter()</code></a><ul>
<li class="chapter" data-level="1.1.1" data-path="filter.html"><a href="filter.html#operators"><i class="fa fa-check"></i><b>1.1.1</b> Operators</a></li>
<li class="chapter" data-level="1.1.2" data-path="filter.html"><a href="filter.html#missing-values"><i class="fa fa-check"></i><b>1.1.2</b> Missing values</a></li>
<li class="chapter" data-level="1.1.3" data-path="filter.html"><a href="filter.html#exercises"><i class="fa fa-check"></i><b>1.1.3</b> Exercises</a></li>
<li class="chapter" data-level="1.1.4" data-path="filter.html"><a href="filter.html#slice"><i class="fa fa-check"></i><b>1.1.4</b> <code>slice()</code></a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="arrange.html"><a href="arrange.html"><i class="fa fa-check"></i><b>1.2</b> <code>arrange()</code></a><ul>
<li class="chapter" data-level="1.2.1" data-path="arrange.html"><a href="arrange.html#exercises-1"><i class="fa fa-check"></i><b>1.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="select.html"><a href="select.html"><i class="fa fa-check"></i><b>1.3</b> <code>select()</code></a><ul>
<li class="chapter" data-level="1.3.1" data-path="select.html"><a href="select.html#练习"><i class="fa fa-check"></i><b>1.3.1</b> 练习</a></li>
<li class="chapter" data-level="1.3.2" data-path="select.html"><a href="select.html#常用创建函数"><i class="fa fa-check"></i><b>1.3.2</b> 常用创建函数</a></li>
<li class="chapter" data-level="1.3.3" data-path="select.html"><a href="select.html#exercises-2"><i class="fa fa-check"></i><b>1.3.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="summarize.html"><a href="summarize.html"><i class="fa fa-check"></i><b>1.4</b> <code>summarize()</code></a><ul>
<li class="chapter" data-level="1.4.1" data-path="summarize.html"><a href="summarize.html#missing-values-in-summarize"><i class="fa fa-check"></i><b>1.4.1</b> Missing values in <code>summarize()</code></a></li>
<li class="chapter" data-level="1.4.2" data-path="summarize.html"><a href="summarize.html#计数函数"><i class="fa fa-check"></i><b>1.4.2</b> 计数函数</a></li>
<li class="chapter" data-level="1.4.3" data-path="summarize.html"><a href="summarize.html#逻辑值的计数和比例sumx-10-和-meany-0"><i class="fa fa-check"></i><b>1.4.3</b> 逻辑值的计数和比例:<code>sum(x &gt; 10) 和 mean(y == 0)</code></a></li>
<li class="chapter" data-level="1.4.4" data-path="summarize.html"><a href="summarize.html#其他常用的摘要函数"><i class="fa fa-check"></i><b>1.4.4</b> 其他常用的摘要函数</a></li>
<li class="chapter" data-level="1.4.5" data-path="summarize.html"><a href="summarize.html#多个分组变量的消耗"><i class="fa fa-check"></i><b>1.4.5</b> 多个分组变量的消耗</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="group-by-combined-with-other-functions.html"><a href="group-by-combined-with-other-functions.html"><i class="fa fa-check"></i><b>1.5</b> <code>group_by()</code> combined with other functions</a></li>
<li class="chapter" data-level="1.6" data-path="dplyr-exercise.html"><a href="dplyr-exercise.html"><i class="fa fa-check"></i><b>1.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="tibble-modern-data-frames.html"><a href="tibble-modern-data-frames.html"><i class="fa fa-check"></i><b>2</b> tibble: Modern data frames</a><ul>
<li class="chapter" data-level="2.1" data-path="tibble-intro.html"><a href="tibble-intro.html"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="tibble-data-frame.html"><a href="tibble-data-frame.html"><i class="fa fa-check"></i><b>2.2</b> Comparing tibble and data.frame</a><ul>
<li class="chapter" data-level="2.2.1" data-path="tibble-data-frame.html"><a href="tibble-data-frame.html#creating"><i class="fa fa-check"></i><b>2.2.1</b> Creating</a></li>
<li class="chapter" data-level="2.2.2" data-path="tibble-data-frame.html"><a href="tibble-data-frame.html#printing"><i class="fa fa-check"></i><b>2.2.2</b> Printing</a></li>
<li class="chapter" data-level="2.2.3" data-path="tibble-data-frame.html"><a href="tibble-data-frame.html#subsetting"><i class="fa fa-check"></i><b>2.2.3</b> Subsetting</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="comparing-two-data-frames-tibbles.html"><a href="comparing-two-data-frames-tibbles.html"><i class="fa fa-check"></i><b>2.3</b> Comparing two data frames (tibbles)</a><ul>
<li class="chapter" data-level="2.3.1" data-path="comparing-two-data-frames-tibbles.html"><a href="comparing-two-data-frames-tibbles.html#dplyrall_equal"><i class="fa fa-check"></i><b>2.3.1</b> <code>dplyr::all_equal()</code></a></li>
<li class="chapter" data-level="2.3.2" data-path="comparing-two-data-frames-tibbles.html"><a href="comparing-two-data-frames-tibbles.html#janitorcompare_df_cols"><i class="fa fa-check"></i><b>2.3.2</b> <code>janitor::compare_df_cols()</code></a></li>
<li class="chapter" data-level="2.3.3" data-path="comparing-two-data-frames-tibbles.html"><a href="comparing-two-data-frames-tibbles.html#vetralike"><i class="fa fa-check"></i><b>2.3.3</b> <code>vetr::alike()</code></a></li>
<li class="chapter" data-level="2.3.4" data-path="comparing-two-data-frames-tibbles.html"><a href="comparing-two-data-frames-tibbles.html#diffdfdiffdf"><i class="fa fa-check"></i><b>2.3.4</b> <code>diffdf::diffdf()</code></a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="tibble-exercise.html"><a href="tibble-exercise.html"><i class="fa fa-check"></i><b>2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="readr-data-import.html"><a href="readr-data-import.html"><i class="fa fa-check"></i><b>3</b> readr: Data import</a><ul>
<li class="chapter" data-level="3.1" data-path="importing-data-in-base-r.html"><a href="importing-data-in-base-r.html"><i class="fa fa-check"></i><b>3.1</b> Importing data in base R</a></li>
<li class="chapter" data-level="3.2" data-path="importing-data-in-readr.html"><a href="importing-data-in-readr.html"><i class="fa fa-check"></i><b>3.2</b> Importing data in <code>readr</code></a><ul>
<li class="chapter" data-level="3.2.1" data-path="importing-data-in-readr.html"><a href="importing-data-in-readr.html#introduction"><i class="fa fa-check"></i><b>3.2.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2.2" data-path="importing-data-in-readr.html"><a href="importing-data-in-readr.html#writing-data"><i class="fa fa-check"></i><b>3.2.2</b> Writing data</a></li>
<li class="chapter" data-level="3.2.3" data-path="importing-data-in-readr.html"><a href="importing-data-in-readr.html#exercises-3"><i class="fa fa-check"></i><b>3.2.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="parsing-a-vector.html"><a href="parsing-a-vector.html"><i class="fa fa-check"></i><b>3.3</b> Parsing a vector</a><ul>
<li class="chapter" data-level="3.3.1" data-path="parsing-a-vector.html"><a href="parsing-a-vector.html#numeric"><i class="fa fa-check"></i><b>3.3.1</b> Numeric</a></li>
<li class="chapter" data-level="3.3.2" data-path="parsing-a-vector.html"><a href="parsing-a-vector.html#character"><i class="fa fa-check"></i><b>3.3.2</b> Character</a></li>
<li class="chapter" data-level="3.3.3" data-path="parsing-a-vector.html"><a href="parsing-a-vector.html#factor"><i class="fa fa-check"></i><b>3.3.3</b> Factor</a></li>
<li class="chapter" data-level="3.3.4" data-path="parsing-a-vector.html"><a href="parsing-a-vector.html#date-and-time"><i class="fa fa-check"></i><b>3.3.4</b> Date and time</a></li>
<li class="chapter" data-level="3.3.5" data-path="parsing-a-vector.html"><a href="parsing-a-vector.html#exercises-4"><i class="fa fa-check"></i><b>3.3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="parsing-a-file.html"><a href="parsing-a-file.html"><i class="fa fa-check"></i><b>3.4</b> Parsing a file</a><ul>
<li class="chapter" data-level="3.4.1" data-path="parsing-a-file.html"><a href="parsing-a-file.html#strategies"><i class="fa fa-check"></i><b>3.4.1</b> Strategies</a></li>
<li class="chapter" data-level="3.4.2" data-path="parsing-a-file.html"><a href="parsing-a-file.html#possible-challenges"><i class="fa fa-check"></i><b>3.4.2</b> Possible challenges</a></li>
<li class="chapter" data-level="3.4.3" data-path="parsing-a-file.html"><a href="parsing-a-file.html#other-tips"><i class="fa fa-check"></i><b>3.4.3</b> Other tips</a></li>
<li class="chapter" data-level="3.4.4" data-path="parsing-a-file.html"><a href="parsing-a-file.html#example-dealing-with-metadata"><i class="fa fa-check"></i><b>3.4.4</b> Example: Dealing with metadata</a></li>
<li class="chapter" data-level="3.4.5" data-path="parsing-a-file.html"><a href="parsing-a-file.html#example-multi-row-headers"><i class="fa fa-check"></i><b>3.4.5</b> Example: multi-row headers</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="readxl.html"><a href="readxl.html"><i class="fa fa-check"></i><b>3.5</b> <code>readxl</code></a><ul>
<li class="chapter" data-level="3.5.1" data-path="readxl.html"><a href="readxl.html#multi-row-headers-in-excel"><i class="fa fa-check"></i><b>3.5.1</b> Multi-row headers in Excel</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="lubridate-dates-and-times.html"><a href="lubridate-dates-and-times.html"><i class="fa fa-check"></i><b>4</b> lubridate: Dates and times</a><ul>
<li class="chapter" data-level="4.1" data-path="creating-dates-and-times.html"><a href="creating-dates-and-times.html"><i class="fa fa-check"></i><b>4.1</b> Creating dates and times</a><ul>
<li class="chapter" data-level="4.1.1" data-path="creating-dates-and-times.html"><a href="creating-dates-and-times.html#from-strings"><i class="fa fa-check"></i><b>4.1.1</b> From strings</a></li>
<li class="chapter" data-level="4.1.2" data-path="creating-dates-and-times.html"><a href="creating-dates-and-times.html#from-individual-components"><i class="fa fa-check"></i><b>4.1.2</b> From individual components</a></li>
<li class="chapter" data-level="4.1.3" data-path="creating-dates-and-times.html"><a href="creating-dates-and-times.html#from-other-times"><i class="fa fa-check"></i><b>4.1.3</b> From other times</a></li>
<li class="chapter" data-level="4.1.4" data-path="creating-dates-and-times.html"><a href="creating-dates-and-times.html#exercises-5"><i class="fa fa-check"></i><b>4.1.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="date-time-components.html"><a href="date-time-components.html"><i class="fa fa-check"></i><b>4.2</b> Date-time components</a><ul>
<li class="chapter" data-level="4.2.1" data-path="date-time-components.html"><a href="date-time-components.html#accessing-components"><i class="fa fa-check"></i><b>4.2.1</b> Accessing components</a></li>
<li class="chapter" data-level="4.2.2" data-path="date-time-components.html"><a href="date-time-components.html#rounding"><i class="fa fa-check"></i><b>4.2.2</b> Rounding</a></li>
<li class="chapter" data-level="4.2.3" data-path="date-time-components.html"><a href="date-time-components.html#setting-components"><i class="fa fa-check"></i><b>4.2.3</b> Setting components</a></li>
<li class="chapter" data-level="4.2.4" data-path="date-time-components.html"><a href="date-time-components.html#exercises-6"><i class="fa fa-check"></i><b>4.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="time-span.html"><a href="time-span.html"><i class="fa fa-check"></i><b>4.3</b> Time span</a><ul>
<li class="chapter" data-level="4.3.1" data-path="time-span.html"><a href="time-span.html#时期-durations"><i class="fa fa-check"></i><b>4.3.1</b> 时期 Durations</a></li>
<li class="chapter" data-level="4.3.2" data-path="time-span.html"><a href="time-span.html#阶段-periods"><i class="fa fa-check"></i><b>4.3.2</b> 阶段 Periods</a></li>
<li class="chapter" data-level="4.3.3" data-path="time-span.html"><a href="time-span.html#区间-intervals"><i class="fa fa-check"></i><b>4.3.3</b> 区间 Intervals</a></li>
<li class="chapter" data-level="4.3.4" data-path="time-span.html"><a href="time-span.html#conclusion"><i class="fa fa-check"></i><b>4.3.4</b> Conclusion</a></li>
<li class="chapter" data-level="4.3.5" data-path="time-span.html"><a href="time-span.html#exercises-7"><i class="fa fa-check"></i><b>4.3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="hms.html"><a href="hms.html"><i class="fa fa-check"></i><b>4.4</b> hms</a></li>
<li class="chapter" data-level="4.5" data-path="dint.html"><a href="dint.html"><i class="fa fa-check"></i><b>4.5</b> dint</a><ul>
<li class="chapter" data-level="4.5.1" data-path="dint.html"><a href="dint.html#creation"><i class="fa fa-check"></i><b>4.5.1</b> Creation</a></li>
<li class="chapter" data-level="4.5.2" data-path="dint.html"><a href="dint.html#arithmetic-and-sequences"><i class="fa fa-check"></i><b>4.5.2</b> Arithmetic and Sequences</a></li>
<li class="chapter" data-level="4.5.3" data-path="dint.html"><a href="dint.html#accessors"><i class="fa fa-check"></i><b>4.5.3</b> Accessors</a></li>
<li class="chapter" data-level="4.5.4" data-path="dint.html"><a href="dint.html#formatting"><i class="fa fa-check"></i><b>4.5.4</b> Formatting</a></li>
<li class="chapter" data-level="4.5.5" data-path="dint.html"><a href="dint.html#labelling-functions-in-ggplot2"><i class="fa fa-check"></i><b>4.5.5</b> Labelling functions in ggplot2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="forcats-factor.html"><a href="forcats-factor.html"><i class="fa fa-check"></i><b>5</b> forcats: factor</a><ul>
<li class="chapter" data-level="5.1" data-path="factor-basics.html"><a href="factor-basics.html"><i class="fa fa-check"></i><b>5.1</b> Factor basics</a></li>
<li class="chapter" data-level="5.2" data-path="sorting.html"><a href="sorting.html"><i class="fa fa-check"></i><b>5.2</b> Sorting</a><ul>
<li class="chapter" data-level="5.2.1" data-path="sorting.html"><a href="sorting.html#sorting-by-frequency-appearance-or-numeric-order"><i class="fa fa-check"></i><b>5.2.1</b> Sorting by frequency, appearance, or numeric order</a></li>
<li class="chapter" data-level="5.2.2" data-path="sorting.html"><a href="sorting.html#sorting-by-another-variable"><i class="fa fa-check"></i><b>5.2.2</b> Sorting by another variable</a></li>
<li class="chapter" data-level="5.2.3" data-path="sorting.html"><a href="sorting.html#sorting-manually"><i class="fa fa-check"></i><b>5.2.3</b> Sorting manually</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="chaninge-number-of-levels.html"><a href="chaninge-number-of-levels.html"><i class="fa fa-check"></i><b>5.3</b> Chaninge number of levels</a><ul>
<li class="chapter" data-level="5.3.1" data-path="chaninge-number-of-levels.html"><a href="chaninge-number-of-levels.html#lumping-levels"><i class="fa fa-check"></i><b>5.3.1</b> Lumping levels</a></li>
<li class="chapter" data-level="5.3.2" data-path="chaninge-number-of-levels.html"><a href="chaninge-number-of-levels.html#expanding-levels"><i class="fa fa-check"></i><b>5.3.2</b> Expanding levels</a></li>
<li class="chapter" data-level="5.3.3" data-path="chaninge-number-of-levels.html"><a href="chaninge-number-of-levels.html#dropping-levels"><i class="fa fa-check"></i><b>5.3.3</b> Dropping levels</a></li>
<li class="chapter" data-level="5.3.4" data-path="chaninge-number-of-levels.html"><a href="chaninge-number-of-levels.html#transforming-na-levels"><i class="fa fa-check"></i><b>5.3.4</b> Transforming NA levels</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="recoding.html"><a href="recoding.html"><i class="fa fa-check"></i><b>5.4</b> Recoding</a><ul>
<li class="chapter" data-level="5.4.1" data-path="recoding.html"><a href="recoding.html#exercises-8"><i class="fa fa-check"></i><b>5.4.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="tidyr-tidy-data.html"><a href="tidyr-tidy-data.html"><i class="fa fa-check"></i><b>6</b> tidyr: Tidy data</a><ul>
<li class="chapter" data-level="6.1" data-path="tidyr-intro.html"><a href="tidyr-intro.html"><i class="fa fa-check"></i><b>6.1</b> Tidy data</a><ul>
<li class="chapter" data-level="6.1.1" data-path="tidyr-intro.html"><a href="tidyr-intro.html#exercises-9"><i class="fa fa-check"></i><b>6.1.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="pivoting.html"><a href="pivoting.html"><i class="fa fa-check"></i><b>6.2</b> Pivoting</a><ul>
<li class="chapter" data-level="6.2.1" data-path="pivoting.html"><a href="pivoting.html#pivot_longer"><i class="fa fa-check"></i><b>6.2.1</b> <code>pivot_longer()</code></a></li>
<li class="chapter" data-level="6.2.2" data-path="pivoting.html"><a href="pivoting.html#pivot_wider"><i class="fa fa-check"></i><b>6.2.2</b> <code>pivot_wider()</code></a></li>
<li class="chapter" data-level="6.2.3" data-path="pivoting.html"><a href="pivoting.html#combining-pivot_longer-and-pivot_wider"><i class="fa fa-check"></i><b>6.2.3</b> Combining <code>pivot_longer()</code> and <code>pivot_wider()</code></a></li>
<li class="chapter" data-level="6.2.4" data-path="pivoting.html"><a href="pivoting.html#exercises-10"><i class="fa fa-check"></i><b>6.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="nesting.html"><a href="nesting.html"><i class="fa fa-check"></i><b>6.3</b> Nesting</a><ul>
<li class="chapter" data-level="6.3.1" data-path="nesting.html"><a href="nesting.html#example-managing-multiple-models"><i class="fa fa-check"></i><b>6.3.1</b> Example: Managing multiple models</a></li>
<li class="chapter" data-level="6.3.2" data-path="nesting.html"><a href="nesting.html#multi-choice"><i class="fa fa-check"></i><b>6.3.2</b> Example: Multicple hoice data</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="rectangling.html"><a href="rectangling.html"><i class="fa fa-check"></i><b>6.4</b> Rectangling</a><ul>
<li class="chapter" data-level="6.4.1" data-path="rectangling.html"><a href="rectangling.html#github-users"><i class="fa fa-check"></i><b>6.4.1</b> Github users</a></li>
<li class="chapter" data-level="6.4.2" data-path="rectangling.html"><a href="rectangling.html#github-repos"><i class="fa fa-check"></i><b>6.4.2</b> Github repos</a></li>
<li class="chapter" data-level="6.4.3" data-path="rectangling.html"><a href="rectangling.html#game-of-throne-characters"><i class="fa fa-check"></i><b>6.4.3</b> Game of Throne characters</a></li>
<li class="chapter" data-level="6.4.4" data-path="rectangling.html"><a href="rectangling.html#sharla-gelfands-discography"><i class="fa fa-check"></i><b>6.4.4</b> Sharla Gelfand’s discography</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="separate-and-untie.html"><a href="separate-and-untie.html"><i class="fa fa-check"></i><b>6.5</b> <code>separate()</code> and <code>untie()</code></a><ul>
<li class="chapter" data-level="6.5.1" data-path="separate-and-untie.html"><a href="separate-and-untie.html#separate"><i class="fa fa-check"></i><b>6.5.1</b> <code>separate()</code></a></li>
<li class="chapter" data-level="6.5.2" data-path="separate-and-untie.html"><a href="separate-and-untie.html#unite"><i class="fa fa-check"></i><b>6.5.2</b> <code>unite()</code></a></li>
<li class="chapter" data-level="6.5.3" data-path="separate-and-untie.html"><a href="separate-and-untie.html#exercises-11"><i class="fa fa-check"></i><b>6.5.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="tidyr-missing.html"><a href="tidyr-missing.html"><i class="fa fa-check"></i><b>6.6</b> Handling missing values</a></li>
<li class="chapter" data-level="6.7" data-path="tidyr-case.html"><a href="tidyr-case.html"><i class="fa fa-check"></i><b>6.7</b> Case Study</a></li>
<li class="chapter" data-level="6.8" data-path="miscellaneous-functions.html"><a href="miscellaneous-functions.html"><i class="fa fa-check"></i><b>6.8</b> Miscellaneous Functions</a><ul>
<li class="chapter" data-level="6.8.1" data-path="miscellaneous-functions.html"><a href="miscellaneous-functions.html#chop-and-unchop"><i class="fa fa-check"></i><b>6.8.1</b> <code>chop()</code> and <code>unchop()</code></a></li>
<li class="chapter" data-level="6.8.2" data-path="miscellaneous-functions.html"><a href="miscellaneous-functions.html#uncount"><i class="fa fa-check"></i><b>6.8.2</b> <code>uncount()</code></a></li>
<li class="chapter" data-level="6.8.3" data-path="miscellaneous-functions.html"><a href="miscellaneous-functions.html#exercises-12"><i class="fa fa-check"></i><b>6.8.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="non-tidy.html"><a href="non-tidy.html"><i class="fa fa-check"></i><b>6.9</b> None-tidy data</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="purrr-functional-programming.html"><a href="purrr-functional-programming.html"><i class="fa fa-check"></i><b>7</b> purrr: Functional programming</a><ul>
<li class="chapter" data-level="7.1" data-path="map-family.html"><a href="map-family.html"><i class="fa fa-check"></i><b>7.1</b> <code>map()</code> family</a></li>
<li class="chapter" data-level="7.2" data-path="producing-atomic-vectors.html"><a href="producing-atomic-vectors.html"><i class="fa fa-check"></i><b>7.2</b> Producing atomic vectors</a><ul>
<li class="chapter" data-level="7.2.1" data-path="producing-atomic-vectors.html"><a href="producing-atomic-vectors.html#purrr-style-anonymous-functions"><i class="fa fa-check"></i><b>7.2.1</b> purrr-style anonymous functions</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="predicate-functions.html"><a href="predicate-functions.html"><i class="fa fa-check"></i><b>7.3</b> Predicate functions</a><ul>
<li class="chapter" data-level="7.3.1" data-path="predicate-functions.html"><a href="predicate-functions.html#basics"><i class="fa fa-check"></i><b>7.3.1</b> Basics</a></li>
<li class="chapter" data-level="7.3.2" data-path="predicate-functions.html"><a href="predicate-functions.html#map-variants"><i class="fa fa-check"></i><b>7.3.2</b> Map variants</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="group-functions.html"><a href="group-functions.html"><i class="fa fa-check"></i><b>7.4</b> group functions</a><ul>
<li class="chapter" data-level="7.4.1" data-path="group-functions.html"><a href="group-functions.html#group_mapgroup_modify"><i class="fa fa-check"></i><b>7.4.1</b> group_map、group_modify</a></li>
<li class="chapter" data-level="7.4.2" data-path="group-functions.html"><a href="group-functions.html#group_nestgroup_splitgroup_keysgroup_data"><i class="fa fa-check"></i><b>7.4.2</b> group_nest、group_split、group_keys、group_data</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="other-useful-tools.html"><a href="other-useful-tools.html"><i class="fa fa-check"></i><b>7.5</b> Other useful tools</a><ul>
<li class="chapter" data-level="7.5.1" data-path="other-useful-tools.html"><a href="other-useful-tools.html#imap"><i class="fa fa-check"></i><b>7.5.1</b> <code>imap()</code></a></li>
<li class="chapter" data-level="7.5.2" data-path="other-useful-tools.html"><a href="other-useful-tools.html#adverbs"><i class="fa fa-check"></i><b>7.5.2</b> adverbs</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="relational-data.html"><a href="relational-data.html"><i class="fa fa-check"></i><b>8</b> Relational data</a><ul>
<li class="chapter" data-level="8.1" data-path="introduction-1.html"><a href="introduction-1.html"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="mutating-joins.html"><a href="mutating-joins.html"><i class="fa fa-check"></i><b>8.2</b> Mutating joins</a></li>
<li class="chapter" data-level="8.3" data-path="filtering-join.html"><a href="filtering-join.html"><i class="fa fa-check"></i><b>8.3</b> Filtering join</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="broom-tidy-representation-of-models.html"><a href="broom-tidy-representation-of-models.html"><i class="fa fa-check"></i><b>9</b> broom: Tidy representation of models</a><ul>
<li class="chapter" data-level="9.1" data-path="viz-many-models.html"><a href="viz-many-models.html"><i class="fa fa-check"></i><b>9.1</b> Visualizing many models</a></li>
<li class="chapter" data-level="9.2" data-path="examples.html"><a href="examples.html"><i class="fa fa-check"></i><b>9.2</b> Examples</a><ul>
<li class="chapter" data-level="9.2.1" data-path="examples.html"><a href="examples.html#pca"><i class="fa fa-check"></i><b>9.2.1</b> PCA</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="broomextra.html"><a href="broomextra.html"><i class="fa fa-check"></i><b>9.3</b> broomExtra</a></li>
<li class="chapter" data-level="9.4" data-path="ggfortify.html"><a href="ggfortify.html"><i class="fa fa-check"></i><b>9.4</b> ggfortify</a></li>
</ul></li>
<li class="part"><span><b>II Importing</b></span></li>
<li class="chapter" data-level="10" data-path="vroom-fast-reading-of-delimited-files.html"><a href="vroom-fast-reading-of-delimited-files.html"><i class="fa fa-check"></i><b>10</b> vroom: Fast reading of delimited files</a></li>
<li class="chapter" data-level="11" data-path="reading-in-data-from-other-formats.html"><a href="reading-in-data-from-other-formats.html"><i class="fa fa-check"></i><b>11</b> Reading in data from other formats</a><ul>
<li class="chapter" data-level="11.1" data-path="pdf.html"><a href="pdf.html"><i class="fa fa-check"></i><b>11.1</b> PDF</a><ul>
<li class="chapter" data-level="11.1.1" data-path="pdf.html"><a href="pdf.html#scraping-pdf-data"><i class="fa fa-check"></i><b>11.1.1</b> Scraping pdf data</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="office-documents.html"><a href="office-documents.html"><i class="fa fa-check"></i><b>11.2</b> Office documents</a></li>
<li class="chapter" data-level="11.3" data-path="google-sheet.html"><a href="google-sheet.html"><i class="fa fa-check"></i><b>11.3</b> Google sheet</a></li>
<li class="chapter" data-level="11.4" data-path="images.html"><a href="images.html"><i class="fa fa-check"></i><b>11.4</b> Images</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="useful-apis.html"><a href="useful-apis.html"><i class="fa fa-check"></i><b>12</b> Useful APIs</a><ul>
<li class="chapter" data-level="12.1" data-path="wdi.html"><a href="wdi.html"><i class="fa fa-check"></i><b>12.1</b> WDI</a><ul>
<li class="chapter" data-level="12.1.1" data-path="wdi.html"><a href="wdi.html#wdisearch"><i class="fa fa-check"></i><b>12.1.1</b> <code>WDIsearch()</code></a></li>
<li class="chapter" data-level="12.1.2" data-path="wdi.html"><a href="wdi.html#wdi-1"><i class="fa fa-check"></i><b>12.1.2</b> <code>WDI</code></a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="ipumsr.html"><a href="ipumsr.html"><i class="fa fa-check"></i><b>12.2</b> ipumsr</a></li>
</ul></li>
<li class="part"><span><b>III Exploring and Wrangling</b></span></li>
<li class="chapter" data-level="13" data-path="data-summary.html"><a href="data-summary.html"><i class="fa fa-check"></i><b>13</b> Data summary</a><ul>
<li class="chapter" data-level="13.1" data-path="skimr.html"><a href="skimr.html"><i class="fa fa-check"></i><b>13.1</b> skimr</a></li>
<li class="chapter" data-level="13.2" data-path="visdat.html"><a href="visdat.html"><i class="fa fa-check"></i><b>13.2</b> visdat</a></li>
<li class="chapter" data-level="13.3" data-path="summarytools.html"><a href="summarytools.html"><i class="fa fa-check"></i><b>13.3</b> summarytools</a><ul>
<li class="chapter" data-level="13.3.1" data-path="summarytools.html"><a href="summarytools.html#freq"><i class="fa fa-check"></i><b>13.3.1</b> <code>freq</code></a></li>
<li class="chapter" data-level="13.3.2" data-path="summarytools.html"><a href="summarytools.html#descr"><i class="fa fa-check"></i><b>13.3.2</b> <code>descr()</code></a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="gt-and-gtsummary.html"><a href="gt-and-gtsummary.html"><i class="fa fa-check"></i><b>13.4</b> gt and gtsummary</a></li>
<li class="chapter" data-level="13.5" data-path="naniar.html"><a href="naniar.html"><i class="fa fa-check"></i><b>13.5</b> naniar</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="janitor.html"><a href="janitor.html"><i class="fa fa-check"></i><b>14</b> Janitor</a><ul>
<li class="chapter" data-level="14.1" data-path="janitor-cleaning.html"><a href="janitor-cleaning.html"><i class="fa fa-check"></i><b>14.1</b> cleaning</a><ul>
<li class="chapter" data-level="14.1.1" data-path="janitor-cleaning.html"><a href="janitor-cleaning.html#clean_names"><i class="fa fa-check"></i><b>14.1.1</b> <code>clean_names</code></a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="janitor-explore.html"><a href="janitor-explore.html"><i class="fa fa-check"></i><b>14.2</b> Exploring</a><ul>
<li class="chapter" data-level="14.2.1" data-path="janitor-explore.html"><a href="janitor-explore.html#tabyl"><i class="fa fa-check"></i><b>14.2.1</b> <code>tabyl</code></a></li>
<li class="chapter" data-level="14.2.2" data-path="janitor-explore.html"><a href="janitor-explore.html#get_dupes"><i class="fa fa-check"></i><b>14.2.2</b> <code>get_dupes</code></a></li>
<li class="chapter" data-level="14.2.3" data-path="janitor-explore.html"><a href="janitor-explore.html#remove_"><i class="fa fa-check"></i><b>14.2.3</b> <code>remove_</code></a></li>
<li class="chapter" data-level="14.2.4" data-path="janitor-explore.html"><a href="janitor-explore.html#round_half_up"><i class="fa fa-check"></i><b>14.2.4</b> <code>round_half_up</code></a></li>
<li class="chapter" data-level="14.2.5" data-path="janitor-explore.html"><a href="janitor-explore.html#excel_numeric_to_date"><i class="fa fa-check"></i><b>14.2.5</b> <code>excel_numeric_to_date</code></a></li>
<li class="chapter" data-level="14.2.6" data-path="janitor-explore.html"><a href="janitor-explore.html#top_levels"><i class="fa fa-check"></i><b>14.2.6</b> <code>top_levels</code></a></li>
<li class="chapter" data-level="14.2.7" data-path="janitor-explore.html"><a href="janitor-explore.html#row_to_names"><i class="fa fa-check"></i><b>14.2.7</b> <code>row_to_names</code></a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Miscellaneous tools</b></span></li>
<li class="chapter" data-level="15" data-path="advanced-relational-data.html"><a href="advanced-relational-data.html"><i class="fa fa-check"></i><b>15</b> Advanced relational data</a><ul>
<li class="chapter" data-level="15.1" data-path="fuzzyjoin.html"><a href="fuzzyjoin.html"><i class="fa fa-check"></i><b>15.1</b> fuzzyjoin</a><ul>
<li class="chapter" data-level="15.1.1" data-path="fuzzyjoin.html"><a href="fuzzyjoin.html#inexact-matching"><i class="fa fa-check"></i><b>15.1.1</b> inexact matching</a></li>
<li class="chapter" data-level="15.1.2" data-path="fuzzyjoin.html"><a href="fuzzyjoin.html#stringdist"><i class="fa fa-check"></i><b>15.1.2</b> stringdist</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="funneljoin.html"><a href="funneljoin.html"><i class="fa fa-check"></i><b>15.2</b> funneljoin</a><ul>
<li class="chapter" data-level="15.2.1" data-path="funneljoin.html"><a href="funneljoin.html#after_join"><i class="fa fa-check"></i><b>15.2.1</b> <code>after_join()</code></a></li>
<li class="chapter" data-level="15.2.2" data-path="funneljoin.html"><a href="funneljoin.html#funnel-in-one-table"><i class="fa fa-check"></i><b>15.2.2</b> funnel in one table</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="dm.html"><a href="dm.html"><i class="fa fa-check"></i><b>15.3</b> dm</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="categorical-data-facotr.html"><a href="categorical-data-facotr.html"><i class="fa fa-check"></i><b>16</b> Categorical data (facotr)</a><ul>
<li class="chapter" data-level="16.1" data-path="frequency-and-contingency-table.html"><a href="frequency-and-contingency-table.html"><i class="fa fa-check"></i><b>16.1</b> Frequency and contingency table</a><ul>
<li class="chapter" data-level="16.1.1" data-path="frequency-and-contingency-table.html"><a href="frequency-and-contingency-table.html#frq-and-flat_table"><i class="fa fa-check"></i><b>16.1.1</b> <code>frq()</code> and <code>flat_table()</code></a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="coding.html"><a href="coding.html"><i class="fa fa-check"></i><b>16.2</b> Coding</a><ul>
<li class="chapter" data-level="16.2.1" data-path="coding.html"><a href="coding.html#rec"><i class="fa fa-check"></i><b>16.2.1</b> <code>rec()</code></a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="cutting.html"><a href="cutting.html"><i class="fa fa-check"></i><b>16.3</b> Cutting</a><ul>
<li class="chapter" data-level="16.3.1" data-path="cutting.html"><a href="cutting.html#chop"><i class="fa fa-check"></i><b>16.3.1</b> <code>chop()</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="dealing-with-missing-values.html"><a href="dealing-with-missing-values.html"><i class="fa fa-check"></i><b>17</b> Dealing with missing values</a><ul>
<li class="chapter" data-level="17.1" data-path="explore-missing.html"><a href="explore-missing.html"><i class="fa fa-check"></i><b>17.1</b> Exploring</a><ul>
<li class="chapter" data-level="17.1.1" data-path="explore-missing.html"><a href="explore-missing.html#naniar-1"><i class="fa fa-check"></i><b>17.1.1</b> naniar</a></li>
<li class="chapter" data-level="17.1.2" data-path="explore-missing.html"><a href="explore-missing.html#replace-a-value-with-na"><i class="fa fa-check"></i><b>17.1.2</b> Replace a value with NA</a></li>
<li class="chapter" data-level="17.1.3" data-path="explore-missing.html"><a href="explore-missing.html#janitor-1"><i class="fa fa-check"></i><b>17.1.3</b> janitor</a></li>
<li class="chapter" data-level="17.1.4" data-path="explore-missing.html"><a href="explore-missing.html#sjmisc"><i class="fa fa-check"></i><b>17.1.4</b> sjmisc</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="wrangling.html"><a href="wrangling.html"><i class="fa fa-check"></i><b>17.2</b> Wrangling</a><ul>
<li class="chapter" data-level="17.2.1" data-path="wrangling.html"><a href="wrangling.html#tidyr"><i class="fa fa-check"></i><b>17.2.1</b> tidyr</a></li>
<li class="chapter" data-level="17.2.2" data-path="wrangling.html"><a href="wrangling.html#janitor-2"><i class="fa fa-check"></i><b>17.2.2</b> janitor</a></li>
<li class="chapter" data-level="17.2.3" data-path="wrangling.html"><a href="wrangling.html#visdat-1"><i class="fa fa-check"></i><b>17.2.3</b> visdat</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="imputation.html"><a href="imputation.html"><i class="fa fa-check"></i><b>17.3</b> Imputation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">written with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R for data science: tidyverse and beyond</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="dplyr-exercise" class="section level2">
<h2><span class="header-section-number">1.6</span> Exercises</h2>

<div class="exercise">
<span id="exr:unnamed-chunk-123" class="exercise"><strong>Exercise 1.10  </strong></span>找到每个日期分组中到达时间延迟最长的10条记录
</div>

<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb113-1" title="1"><span class="co"># min_rank自动在分组内排序</span></a>
<a class="sourceLine" id="cb113-2" title="2">not_cancelled <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb113-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(year,month,day) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb113-4" title="4"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">rank</span>(<span class="kw">desc</span>(arr_delay)) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb113-5" title="5"><span class="st">  </span><span class="kw">select</span>(month,year,day,arr_delay)</a>
<a class="sourceLine" id="cb113-6" title="6"><span class="co">#&gt; # A tibble: 3,609 x 4</span></a>
<a class="sourceLine" id="cb113-7" title="7"><span class="co">#&gt; # Groups:   year, month, day [365]</span></a>
<a class="sourceLine" id="cb113-8" title="8"><span class="co">#&gt;   month  year   day arr_delay</span></a>
<a class="sourceLine" id="cb113-9" title="9"><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb113-10" title="10"><span class="co">#&gt; 1     1  2013     1       851</span></a>
<a class="sourceLine" id="cb113-11" title="11"><span class="co">#&gt; 2     1  2013     1       338</span></a>
<a class="sourceLine" id="cb113-12" title="12"><span class="co">#&gt; 3     1  2013     1       263</span></a>
<a class="sourceLine" id="cb113-13" title="13"><span class="co">#&gt; 4     1  2013     1       166</span></a>
<a class="sourceLine" id="cb113-14" title="14"><span class="co">#&gt; 5     1  2013     1       174</span></a>
<a class="sourceLine" id="cb113-15" title="15"><span class="co">#&gt; 6     1  2013     1       222</span></a>
<a class="sourceLine" id="cb113-16" title="16"><span class="co">#&gt; # ... with 3,603 more rows</span></a></code></pre></div>

<div class="exercise">
<span id="exr:unnamed-chunk-125" class="exercise"><strong>Exercise 1.11  </strong></span>找出一年中到达航班多于 365 次的目的地：
</div>

<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb114-1" title="1">not_cancelled <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb114-2" title="2"><span class="st">  </span><span class="kw">count</span>(dest, <span class="dt">sort =</span> T) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb114-3" title="3"><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">365</span>)</a>
<a class="sourceLine" id="cb114-4" title="4"><span class="co">#&gt; # A tibble: 75 x 2</span></a>
<a class="sourceLine" id="cb114-5" title="5"><span class="co">#&gt;   dest      n</span></a>
<a class="sourceLine" id="cb114-6" title="6"><span class="co">#&gt;   &lt;chr&gt; &lt;int&gt;</span></a>
<a class="sourceLine" id="cb114-7" title="7"><span class="co">#&gt; 1 ATL   16837</span></a>
<a class="sourceLine" id="cb114-8" title="8"><span class="co">#&gt; 2 ORD   16566</span></a>
<a class="sourceLine" id="cb114-9" title="9"><span class="co">#&gt; 3 LAX   16026</span></a>
<a class="sourceLine" id="cb114-10" title="10"><span class="co">#&gt; 4 BOS   15022</span></a>
<a class="sourceLine" id="cb114-11" title="11"><span class="co">#&gt; 5 MCO   13967</span></a>
<a class="sourceLine" id="cb114-12" title="12"><span class="co">#&gt; 6 CLT   13674</span></a>
<a class="sourceLine" id="cb114-13" title="13"><span class="co">#&gt; # ... with 69 more rows</span></a>
<a class="sourceLine" id="cb114-14" title="14"></a>
<a class="sourceLine" id="cb114-15" title="15"><span class="co"># another solution </span></a>
<a class="sourceLine" id="cb114-16" title="16">not_cancelled <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb114-17" title="17"><span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb114-18" title="18"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">&gt;</span><span class="st"> </span><span class="dv">365</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb114-19" title="19"><span class="st">  </span><span class="kw">distinct</span>(dest)</a>
<a class="sourceLine" id="cb114-20" title="20"><span class="co">#&gt; # A tibble: 75 x 1</span></a>
<a class="sourceLine" id="cb114-21" title="21"><span class="co">#&gt; # Groups:   dest [75]</span></a>
<a class="sourceLine" id="cb114-22" title="22"><span class="co">#&gt;   dest </span></a>
<a class="sourceLine" id="cb114-23" title="23"><span class="co">#&gt;   &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb114-24" title="24"><span class="co">#&gt; 1 IAH  </span></a>
<a class="sourceLine" id="cb114-25" title="25"><span class="co">#&gt; 2 MIA  </span></a>
<a class="sourceLine" id="cb114-26" title="26"><span class="co">#&gt; 3 BQN  </span></a>
<a class="sourceLine" id="cb114-27" title="27"><span class="co">#&gt; 4 ATL  </span></a>
<a class="sourceLine" id="cb114-28" title="28"><span class="co">#&gt; 5 ORD  </span></a>
<a class="sourceLine" id="cb114-29" title="29"><span class="co">#&gt; 6 FLL  </span></a>
<a class="sourceLine" id="cb114-30" title="30"><span class="co">#&gt; # ... with 69 more rows</span></a></code></pre></div>

<div class="exercise">
<span id="exr:unnamed-chunk-127" class="exercise"><strong>Exercise 1.12  </strong></span>哪一架飞机(<code>tailnum</code>)具有最差的准点记录：
</div>

<p>衡量一个飞机的准点情况有很多种可能的选择，这里只提供两个方向：</p>
<ul>
<li>该航班未取消且延误（到达和出发）次数占总飞行次数的比例最小<br />
</li>
<li>该航班的平均到达延误时间最长</li>
</ul>
<p>从第一个方向出发：</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb115-1" title="1"><span class="co">## 查看飞机飞行次数的分布</span></a>
<a class="sourceLine" id="cb115-2" title="2">count_by_tail &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb115-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(tailnum) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb115-4" title="4"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">n =</span> <span class="kw">n</span>())</a>
<a class="sourceLine" id="cb115-5" title="5"></a>
<a class="sourceLine" id="cb115-6" title="6"><span class="kw">quantile</span>(count_by_tail<span class="op">$</span>n)</a>
<a class="sourceLine" id="cb115-7" title="7"><span class="co">#&gt;   0%  25%  50%  75% 100% </span></a>
<a class="sourceLine" id="cb115-8" title="8"><span class="co">#&gt;    1   23   54  110 2512</span></a>
<a class="sourceLine" id="cb115-9" title="9"></a>
<a class="sourceLine" id="cb115-10" title="10"></a>
<a class="sourceLine" id="cb115-11" title="11">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb115-12" title="12"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(tailnum)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb115-13" title="13"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">on_time =</span> <span class="op">!</span><span class="kw">is.na</span>(arr_time) <span class="op">&amp;</span><span class="st"> </span>(arr_delay <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&amp;</span><span class="st"> </span>(dep_delay <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>) ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb115-14" title="14"><span class="st">  </span><span class="kw">group_by</span>(tailnum) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb115-15" title="15"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">on_time =</span> <span class="kw">mean</span>(on_time), <span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span><span class="co">## mean和逻辑值结合计算比例</span></a>
<a class="sourceLine" id="cb115-16" title="16"><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">20</span>) <span class="op">%&gt;%</span><span class="st">  </span><span class="co">## 避免因频次过少做出结论,选择20是因为它是飞行次数的下四分位数</span></a>
<a class="sourceLine" id="cb115-17" title="17"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">min_rank</span>(on_time) <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)     <span class="co">## 未取消且准点比例最低的飞机</span></a>
<a class="sourceLine" id="cb115-18" title="18"><span class="co">#&gt; # A tibble: 1 x 3</span></a>
<a class="sourceLine" id="cb115-19" title="19"><span class="co">#&gt;   tailnum on_time     n</span></a>
<a class="sourceLine" id="cb115-20" title="20"><span class="co">#&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;int&gt;</span></a>
<a class="sourceLine" id="cb115-21" title="21"><span class="co">#&gt; 1 N988AT   0.0541    37</span></a></code></pre></div>
<p>接下来是第二个方向：</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb116-1" title="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb116-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(tailnum) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb116-3" title="3"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">arr_delay =</span> <span class="kw">mean</span>(arr_delay,<span class="dt">na.rm =</span> T),<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st">  </span><span class="co">##注意这一步的mean中的参数</span></a>
<a class="sourceLine" id="cb116-4" title="4"><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">20</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb116-5" title="5"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">min_rank</span>(<span class="kw">desc</span>(arr_delay)) <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb116-6" title="6"><span class="co">#&gt; # A tibble: 1 x 3</span></a>
<a class="sourceLine" id="cb116-7" title="7"><span class="co">#&gt;   tailnum arr_delay     n</span></a>
<a class="sourceLine" id="cb116-8" title="8"><span class="co">#&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;</span></a>
<a class="sourceLine" id="cb116-9" title="9"><span class="co">#&gt; 1 N203FR       59.1    41</span></a></code></pre></div>

<div class="exercise">
<p><span id="exr:unnamed-chunk-130" class="exercise"><strong>Exercise 1.13  </strong></span>如果想要尽量避免航班延误，应该在一天中的哪个时间搭乘飞机？</p>
</div>

<p>对 <code>hour</code> 分组计算平均到达延误时间：</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb117-1" title="1">flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb117-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(hour) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb117-3" title="3"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">arr_delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> T)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb117-4" title="4"><span class="st">  </span><span class="kw">arrange</span>(arr_delay) </a>
<a class="sourceLine" id="cb117-5" title="5"><span class="co">#&gt; # A tibble: 20 x 2</span></a>
<a class="sourceLine" id="cb117-6" title="6"><span class="co">#&gt;    hour arr_delay</span></a>
<a class="sourceLine" id="cb117-7" title="7"><span class="co">#&gt;   &lt;dbl&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb117-8" title="8"><span class="co">#&gt; 1     7    -5.30 </span></a>
<a class="sourceLine" id="cb117-9" title="9"><span class="co">#&gt; 2     5    -4.80 </span></a>
<a class="sourceLine" id="cb117-10" title="10"><span class="co">#&gt; 3     6    -3.38 </span></a>
<a class="sourceLine" id="cb117-11" title="11"><span class="co">#&gt; 4     9    -1.45 </span></a>
<a class="sourceLine" id="cb117-12" title="12"><span class="co">#&gt; 5     8    -1.11 </span></a>
<a class="sourceLine" id="cb117-13" title="13"><span class="co">#&gt; 6    10     0.954</span></a>
<a class="sourceLine" id="cb117-14" title="14"><span class="co">#&gt; # ... with 14 more rows</span></a></code></pre></div>

<div class="exercise">
<span id="exr:unnamed-chunk-132" class="exercise"><strong>Exercise 1.14  </strong></span>计算每个目的地的到达延误总时间的分钟数，以及每条记录到每个目的地的延误时间比例
</div>

<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb118-1" title="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb118-2" title="2"><span class="st">  </span><span class="kw">filter</span>(arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb118-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb118-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb118-5" title="5">    <span class="dt">arr_delay_total =</span> <span class="kw">sum</span>(arr_delay),  <span class="co">## 经过分组后，求和在组内操作</span></a>
<a class="sourceLine" id="cb118-6" title="6">    <span class="dt">arr_delay_prop =</span> arr_delay <span class="op">/</span><span class="st"> </span>arr_delay_total</a>
<a class="sourceLine" id="cb118-7" title="7">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb118-8" title="8"><span class="st">  </span><span class="kw">select</span>(</a>
<a class="sourceLine" id="cb118-9" title="9">    dest, tailnum,</a>
<a class="sourceLine" id="cb118-10" title="10">    arr_delay, arr_delay_prop</a>
<a class="sourceLine" id="cb118-11" title="11">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb118-12" title="12"><span class="st">  </span><span class="kw">arrange</span>(dest, <span class="kw">desc</span>(arr_delay_prop))</a>
<a class="sourceLine" id="cb118-13" title="13"><span class="co">#&gt; # A tibble: 133,004 x 4</span></a>
<a class="sourceLine" id="cb118-14" title="14"><span class="co">#&gt; # Groups:   dest [103]</span></a>
<a class="sourceLine" id="cb118-15" title="15"><span class="co">#&gt;   dest  tailnum arr_delay arr_delay_prop</span></a>
<a class="sourceLine" id="cb118-16" title="16"><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt;          &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb118-17" title="17"><span class="co">#&gt; 1 ABQ   N784JB        153         0.0341</span></a>
<a class="sourceLine" id="cb118-18" title="18"><span class="co">#&gt; 2 ABQ   N659JB        149         0.0332</span></a>
<a class="sourceLine" id="cb118-19" title="19"><span class="co">#&gt; 3 ABQ   N640JB        138         0.0308</span></a>
<a class="sourceLine" id="cb118-20" title="20"><span class="co">#&gt; 4 ABQ   N589JB        137         0.0305</span></a>
<a class="sourceLine" id="cb118-21" title="21"><span class="co">#&gt; 5 ABQ   N556JB        136         0.0303</span></a>
<a class="sourceLine" id="cb118-22" title="22"><span class="co">#&gt; 6 ABQ   N598JB        126         0.0281</span></a>
<a class="sourceLine" id="cb118-23" title="23"><span class="co">#&gt; # ... with 132,998 more rows</span></a></code></pre></div>

<div class="exercise">
<span id="exr:unnamed-chunk-134" class="exercise"><strong>Exercise 1.15  </strong></span>延误通常是由临时原因造成的：即使最初引起延误的问题已经解决，但因为要让前面的航班先起飞，所以后面的航班也会延误。使用<code>lag()</code> 探究一架航班延误与前一架航班延误之间的关系。
</div>

<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb119-1" title="1"><span class="co">## This calculates the departure delay of the preceding flight from the same airport.</span></a>
<a class="sourceLine" id="cb119-2" title="2"> (lagged_delays &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb119-3" title="3"><span class="st">  </span><span class="kw">arrange</span>(origin, month, day, dep_time) <span class="op">%&gt;%</span><span class="st">  </span><span class="co">## 这一步排序确保了偏移是有意义的</span></a>
<a class="sourceLine" id="cb119-4" title="4"><span class="st">  </span><span class="kw">group_by</span>(origin) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb119-5" title="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dep_delay_lag =</span> <span class="kw">lag</span>(dep_delay)) <span class="op">%&gt;%</span><span class="st">  </span><span class="co">## 偏移函数基于分组</span></a>
<a class="sourceLine" id="cb119-6" title="6"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(dep_delay),<span class="op">!</span><span class="kw">is.na</span>(dep_delay_lag)))</a>
<a class="sourceLine" id="cb119-7" title="7"><span class="co">#&gt; # A tibble: 327,649 x 20</span></a>
<a class="sourceLine" id="cb119-8" title="8"><span class="co">#&gt; # Groups:   origin [3]</span></a>
<a class="sourceLine" id="cb119-9" title="9"><span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time</span></a>
<a class="sourceLine" id="cb119-10" title="10"><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;</span></a>
<a class="sourceLine" id="cb119-11" title="11"><span class="co">#&gt; 1  2013     1     1      554            558        -4      740            728</span></a>
<a class="sourceLine" id="cb119-12" title="12"><span class="co">#&gt; 2  2013     1     1      555            600        -5      913            854</span></a>
<a class="sourceLine" id="cb119-13" title="13"><span class="co">#&gt; 3  2013     1     1      558            600        -2      923            937</span></a>
<a class="sourceLine" id="cb119-14" title="14"><span class="co">#&gt; 4  2013     1     1      559            600        -1      854            902</span></a>
<a class="sourceLine" id="cb119-15" title="15"><span class="co">#&gt; 5  2013     1     1      601            600         1      844            850</span></a>
<a class="sourceLine" id="cb119-16" title="16"><span class="co">#&gt; 6  2013     1     1      606            610        -4      858            910</span></a>
<a class="sourceLine" id="cb119-17" title="17"><span class="co">#&gt; # ... with 327,643 more rows, and 12 more variables: arr_delay &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb119-18" title="18"><span class="co">#&gt; #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb119-19" title="19"><span class="co">#&gt; #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;,</span></a>
<a class="sourceLine" id="cb119-20" title="20"><span class="co">#&gt; #   dep_delay_lag &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb119-21" title="21"></a>
<a class="sourceLine" id="cb119-22" title="22">lagged_delays <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb119-23" title="23"><span class="st">  </span><span class="kw">group_by</span>(dep_delay_lag) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb119-24" title="24"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">dep_delay_mean =</span> <span class="kw">mean</span>(dep_delay)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb119-25" title="25"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> dep_delay_mean, <span class="dt">x =</span> dep_delay_lag)) <span class="op">+</span></a>
<a class="sourceLine" id="cb119-26" title="26"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb119-27" title="27"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1500</span>, <span class="dt">by =</span> <span class="dv">120</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb119-28" title="28"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;Departure Delay&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Previous Departure Delay&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb119-29" title="29"><span class="st">  </span><span class="kw">theme_classic</span>()</a></code></pre></div>
<p><img src="dplyr-core_files/figure-html/unnamed-chunk-135-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb120-1" title="1">    </a>
<a class="sourceLine" id="cb120-2" title="2"><span class="co">## This plots the relationship between the mean delay of a flight for all values of the previous flight. For delays less than two hours, the relationship between the delay of the preceding flight and the current flight is nearly a line. After that the relationship becomes more variable, as long-delayed flights are interspersed with flights leaving on-time. After about 8-hours, a delayed flight is likely to be followed by a flight leaving on time.</span></a></code></pre></div>

<div class="exercise">
<span id="exr:unnamed-chunk-136" class="exercise"><strong>Exercise 1.16  </strong></span>根据到达地点的数量，对航空公司进行排序 ; 找出至少有两个航空公司的目的地
</div>

<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" title="1"><span class="co">## rank carriers by numer of destinations</span></a>
<a class="sourceLine" id="cb121-2" title="2">flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb121-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(carrier) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb121-4" title="4"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">n_dest =</span> <span class="kw">n_distinct</span>(dest)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb121-5" title="5"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n_dest))</a>
<a class="sourceLine" id="cb121-6" title="6"><span class="co">#&gt; # A tibble: 16 x 2</span></a>
<a class="sourceLine" id="cb121-7" title="7"><span class="co">#&gt;   carrier n_dest</span></a>
<a class="sourceLine" id="cb121-8" title="8"><span class="co">#&gt;   &lt;chr&gt;    &lt;int&gt;</span></a>
<a class="sourceLine" id="cb121-9" title="9"><span class="co">#&gt; 1 EV          61</span></a>
<a class="sourceLine" id="cb121-10" title="10"><span class="co">#&gt; 2 9E          49</span></a>
<a class="sourceLine" id="cb121-11" title="11"><span class="co">#&gt; 3 UA          47</span></a>
<a class="sourceLine" id="cb121-12" title="12"><span class="co">#&gt; 4 B6          42</span></a>
<a class="sourceLine" id="cb121-13" title="13"><span class="co">#&gt; 5 DL          40</span></a>
<a class="sourceLine" id="cb121-14" title="14"><span class="co">#&gt; 6 MQ          20</span></a>
<a class="sourceLine" id="cb121-15" title="15"><span class="co">#&gt; # ... with 10 more rows</span></a>
<a class="sourceLine" id="cb121-16" title="16"></a>
<a class="sourceLine" id="cb121-17" title="17"><span class="co">## find all airports with &gt; 1 carrier</span></a>
<a class="sourceLine" id="cb121-18" title="18">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb121-19" title="19"><span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb121-20" title="20"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">n_carriers =</span> <span class="kw">n_distinct</span>(carrier)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb121-21" title="21"><span class="st">  </span><span class="kw">filter</span>(n_carriers <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb121-22" title="22"><span class="co">#&gt; # A tibble: 76 x 2</span></a>
<a class="sourceLine" id="cb121-23" title="23"><span class="co">#&gt;   dest  n_carriers</span></a>
<a class="sourceLine" id="cb121-24" title="24"><span class="co">#&gt;   &lt;chr&gt;      &lt;int&gt;</span></a>
<a class="sourceLine" id="cb121-25" title="25"><span class="co">#&gt; 1 ATL            7</span></a>
<a class="sourceLine" id="cb121-26" title="26"><span class="co">#&gt; 2 AUS            6</span></a>
<a class="sourceLine" id="cb121-27" title="27"><span class="co">#&gt; 3 AVL            2</span></a>
<a class="sourceLine" id="cb121-28" title="28"><span class="co">#&gt; 4 BDL            2</span></a>
<a class="sourceLine" id="cb121-29" title="29"><span class="co">#&gt; 5 BGR            2</span></a>
<a class="sourceLine" id="cb121-30" title="30"><span class="co">#&gt; 6 BNA            5</span></a>
<a class="sourceLine" id="cb121-31" title="31"><span class="co">#&gt; # ... with 70 more rows</span></a></code></pre></div>

<div class="exercise">
<span id="exr:unnamed-chunk-138" class="exercise"><strong>Exercise 1.17  </strong></span>每天取消的航班数量和总航班数量存在什么关系？每天的平均到达延误时间和取消航班的比例有什么关系？
</div>

<p>取消的航班定义为<code>is.na(arr_delay) | is.na(dep_delay)</code></p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb122-1" title="1"><span class="co">## One pattern in cancelled flights per day is that </span></a>
<a class="sourceLine" id="cb122-2" title="2"><span class="co">## the number of cancelled flights increases with the total number of flights per day. </span></a>
<a class="sourceLine" id="cb122-3" title="3">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb122-4" title="4"><span class="st">  </span><span class="kw">group_by</span>(year,month,day) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb122-5" title="5"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">n_cancelled =</span> <span class="kw">sum</span>(<span class="kw">is.na</span>(arr_delay) <span class="op">|</span><span class="st"> </span><span class="kw">is.na</span>(dep_delay)),<span class="dt">n_total =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb122-6" title="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> n_total,<span class="dt">y =</span> n_cancelled)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="dplyr-core_files/figure-html/unnamed-chunk-139-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" title="1"></a>
<a class="sourceLine" id="cb123-2" title="2"><span class="co">#2</span></a>
<a class="sourceLine" id="cb123-3" title="3">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-4" title="4"><span class="st">  </span><span class="kw">group_by</span>(year,month,day) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-5" title="5"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">cancelled_prop =</span> <span class="kw">mean</span>(<span class="kw">is.na</span>(arr_delay) <span class="op">|</span><span class="st"> </span><span class="kw">is.na</span>(dep_delay)),</a>
<a class="sourceLine" id="cb123-6" title="6">            <span class="dt">avg_arr_delay =</span> <span class="kw">mean</span>(arr_delay,<span class="dt">na.rm =</span> T)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-7" title="7"><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> avg_arr_delay,<span class="dt">y =</span> cancelled_prop))</a></code></pre></div>
<p><img src="dplyr-core_files/figure-html/unnamed-chunk-139-2.svg" width="672" style="display: block; margin: auto;" /></p>

<div class="exercise">
<span id="exr:unnamed-chunk-140" class="exercise"><strong>Exercise 1.18  </strong></span>
哪个航空公司的延误情况最严重？你能否分清这是因为糟糕的机场设备，还是航空公司的问题？（考虑一下<code>flights %&gt;% group_by(carrier,dest) %&gt;% summarize(n())</code>
</div>

<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb124-1" title="1">flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb124-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(carrier) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb124-3" title="3"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">avg_arr_delay =</span> <span class="kw">mean</span>(arr_delay,<span class="dt">na.rm =</span> T)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb124-4" title="4"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(avg_arr_delay))</a>
<a class="sourceLine" id="cb124-5" title="5"><span class="co">#&gt; # A tibble: 16 x 2</span></a>
<a class="sourceLine" id="cb124-6" title="6"><span class="co">#&gt;   carrier avg_arr_delay</span></a>
<a class="sourceLine" id="cb124-7" title="7"><span class="co">#&gt;   &lt;chr&gt;           &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb124-8" title="8"><span class="co">#&gt; 1 F9               21.9</span></a>
<a class="sourceLine" id="cb124-9" title="9"><span class="co">#&gt; 2 FL               20.1</span></a>
<a class="sourceLine" id="cb124-10" title="10"><span class="co">#&gt; 3 EV               15.8</span></a>
<a class="sourceLine" id="cb124-11" title="11"><span class="co">#&gt; 4 YV               15.6</span></a>
<a class="sourceLine" id="cb124-12" title="12"><span class="co">#&gt; 5 OO               11.9</span></a>
<a class="sourceLine" id="cb124-13" title="13"><span class="co">#&gt; 6 MQ               10.8</span></a>
<a class="sourceLine" id="cb124-14" title="14"><span class="co">#&gt; # ... with 10 more rows</span></a>
<a class="sourceLine" id="cb124-15" title="15"></a>
<a class="sourceLine" id="cb124-16" title="16"><span class="co">## What airline corresponds to the &quot;F9&quot; carrier code?</span></a>
<a class="sourceLine" id="cb124-17" title="17"><span class="kw">filter</span>(airlines,carrier <span class="op">==</span><span class="st"> &quot;F9&quot;</span>)</a>
<a class="sourceLine" id="cb124-18" title="18"><span class="co">#&gt; # A tibble: 1 x 2</span></a>
<a class="sourceLine" id="cb124-19" title="19"><span class="co">#&gt;   carrier name                  </span></a>
<a class="sourceLine" id="cb124-20" title="20"><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;                 </span></a>
<a class="sourceLine" id="cb124-21" title="21"><span class="co">#&gt; 1 F9      Frontier Airlines Inc.</span></a></code></pre></div>
<blockquote>
<p>You can get part of the way to disentangling the effects of airports versus bad carriers by comparing the average delay of each carrier to the average delay of flights within a route (flights from the same origin to the same destination). Comparing delays between carriers and within each route disentangles the effect of carriers and airports. A better analysis would compare the average delay of a carrier’s flights to the average delay of all other carrier’s flights within a route.</p>
</blockquote>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" title="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb125-2" title="2"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(arr_delay)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb125-3" title="3"><span class="st">  </span><span class="co"># Total delay by carrier within each origin, dest</span></a>
<a class="sourceLine" id="cb125-4" title="4"><span class="st">  </span><span class="kw">group_by</span>(origin, dest, carrier) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb125-5" title="5"><span class="st">  </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb125-6" title="6">    <span class="dt">arr_delay =</span> <span class="kw">sum</span>(arr_delay),</a>
<a class="sourceLine" id="cb125-7" title="7">    <span class="dt">flights =</span> <span class="kw">n</span>()</a>
<a class="sourceLine" id="cb125-8" title="8">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb125-9" title="9"><span class="st">  </span><span class="co"># Total delay within each origin dest</span></a>
<a class="sourceLine" id="cb125-10" title="10"><span class="st">  </span><span class="kw">group_by</span>(origin, dest) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb125-11" title="11"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb125-12" title="12">    <span class="dt">arr_delay_total =</span> <span class="kw">sum</span>(arr_delay),</a>
<a class="sourceLine" id="cb125-13" title="13">    <span class="dt">flights_total =</span> <span class="kw">sum</span>(flights)</a>
<a class="sourceLine" id="cb125-14" title="14">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb125-15" title="15"><span class="st">  </span><span class="co"># average delay of each carrier - average delay of other carriers</span></a>
<a class="sourceLine" id="cb125-16" title="16"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb125-17" title="17"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb125-18" title="18">    <span class="dt">arr_delay_others =</span> (arr_delay_total <span class="op">-</span><span class="st"> </span>arr_delay) <span class="op">/</span></a>
<a class="sourceLine" id="cb125-19" title="19"><span class="st">      </span>(flights_total <span class="op">-</span><span class="st"> </span>flights),</a>
<a class="sourceLine" id="cb125-20" title="20">    <span class="dt">arr_delay_mean =</span> arr_delay <span class="op">/</span><span class="st"> </span>flights,</a>
<a class="sourceLine" id="cb125-21" title="21">    <span class="dt">arr_delay_diff =</span> arr_delay_mean <span class="op">-</span><span class="st"> </span>arr_delay_others</a>
<a class="sourceLine" id="cb125-22" title="22">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb125-23" title="23"><span class="st">  </span><span class="co"># remove NaN values (when there is only one carrier)</span></a>
<a class="sourceLine" id="cb125-24" title="24"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">is.finite</span>(arr_delay_diff)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb125-25" title="25"><span class="st">  </span><span class="co"># average over all airports it flies to</span></a>
<a class="sourceLine" id="cb125-26" title="26"><span class="st">  </span><span class="kw">group_by</span>(carrier) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb125-27" title="27"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">arr_delay_diff =</span> <span class="kw">mean</span>(arr_delay_diff)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb125-28" title="28"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(arr_delay_diff))</a>
<a class="sourceLine" id="cb125-29" title="29"><span class="co">#&gt; # A tibble: 15 x 2</span></a>
<a class="sourceLine" id="cb125-30" title="30"><span class="co">#&gt;   carrier arr_delay_diff</span></a>
<a class="sourceLine" id="cb125-31" title="31"><span class="co">#&gt;   &lt;chr&gt;            &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb125-32" title="32"><span class="co">#&gt; 1 OO              27.3  </span></a>
<a class="sourceLine" id="cb125-33" title="33"><span class="co">#&gt; 2 F9              17.3  </span></a>
<a class="sourceLine" id="cb125-34" title="34"><span class="co">#&gt; 3 EV              11.0  </span></a>
<a class="sourceLine" id="cb125-35" title="35"><span class="co">#&gt; 4 B6               6.41 </span></a>
<a class="sourceLine" id="cb125-36" title="36"><span class="co">#&gt; 5 FL               2.57 </span></a>
<a class="sourceLine" id="cb125-37" title="37"><span class="co">#&gt; 6 VX              -0.202</span></a>
<a class="sourceLine" id="cb125-38" title="38"><span class="co">#&gt; # ... with 9 more rows</span></a></code></pre></div>

</div>
<!-- </div> -->
            </section>

          </div>
        </div>
      </div>
<a href="group-by-combined-with-other-functions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="tibble-modern-data-frames.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/enixam/rfordatascience/edit/master/dplyr-core.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
