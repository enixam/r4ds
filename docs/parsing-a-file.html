<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3.4 Parsing a file | R for data science: tidyverse and beyond</title>
  <meta name="description" content="3.4 Parsing a file | R for data science: tidyverse and beyond" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="3.4 Parsing a file | R for data science: tidyverse and beyond" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="enixam/rfordatascience" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3.4 Parsing a file | R for data science: tidyverse and beyond" />
  
  
  

<meta name="author" content="Maxine" />


<meta name="date" content="2020-05-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="parsing-a-vector.html"/>
<link rel="next" href="readxl.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/jsoneditor-5.25.6/jsoneditor.min.css" rel="stylesheet" />
<script src="libs/jsoneditor-5.25.6/jsoneditor.min.js"></script>
<script src="libs/jsonedit-binding-3.0.0/jsonedit.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css\style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R4DS: tidyverse and beyond</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>前言</a></li>
<li class="part"><span><b>I R for data science</b></span></li>
<li class="chapter" data-level="1" data-path="dplyr-data-transformation.html"><a href="dplyr-data-transformation.html"><i class="fa fa-check"></i><b>1</b> dplyr: Data transformation</a><ul>
<li class="chapter" data-level="1.1" data-path="filter.html"><a href="filter.html"><i class="fa fa-check"></i><b>1.1</b> <code>filter()</code></a><ul>
<li class="chapter" data-level="1.1.1" data-path="filter.html"><a href="filter.html#operators"><i class="fa fa-check"></i><b>1.1.1</b> Operators</a></li>
<li class="chapter" data-level="1.1.2" data-path="filter.html"><a href="filter.html#missing-values"><i class="fa fa-check"></i><b>1.1.2</b> Missing values</a></li>
<li class="chapter" data-level="1.1.3" data-path="filter.html"><a href="filter.html#exercises"><i class="fa fa-check"></i><b>1.1.3</b> Exercises</a></li>
<li class="chapter" data-level="1.1.4" data-path="filter.html"><a href="filter.html#slice"><i class="fa fa-check"></i><b>1.1.4</b> <code>slice()</code></a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="arrange.html"><a href="arrange.html"><i class="fa fa-check"></i><b>1.2</b> <code>arrange()</code></a><ul>
<li class="chapter" data-level="1.2.1" data-path="arrange.html"><a href="arrange.html#exercises-1"><i class="fa fa-check"></i><b>1.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="select.html"><a href="select.html"><i class="fa fa-check"></i><b>1.3</b> <code>select()</code></a><ul>
<li class="chapter" data-level="1.3.1" data-path="select.html"><a href="select.html#练习"><i class="fa fa-check"></i><b>1.3.1</b> 练习</a></li>
<li class="chapter" data-level="1.3.2" data-path="select.html"><a href="select.html#常用创建函数"><i class="fa fa-check"></i><b>1.3.2</b> 常用创建函数</a></li>
<li class="chapter" data-level="1.3.3" data-path="select.html"><a href="select.html#exercises-2"><i class="fa fa-check"></i><b>1.3.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="summarize.html"><a href="summarize.html"><i class="fa fa-check"></i><b>1.4</b> <code>summarize()</code></a><ul>
<li class="chapter" data-level="1.4.1" data-path="summarize.html"><a href="summarize.html#missing-values-in-summarize"><i class="fa fa-check"></i><b>1.4.1</b> Missing values in <code>summarize()</code></a></li>
<li class="chapter" data-level="1.4.2" data-path="summarize.html"><a href="summarize.html#计数函数"><i class="fa fa-check"></i><b>1.4.2</b> 计数函数</a></li>
<li class="chapter" data-level="1.4.3" data-path="summarize.html"><a href="summarize.html#逻辑值的计数和比例sumx-10-和-meany-0"><i class="fa fa-check"></i><b>1.4.3</b> 逻辑值的计数和比例:<code>sum(x &gt; 10) 和 mean(y == 0)</code></a></li>
<li class="chapter" data-level="1.4.4" data-path="summarize.html"><a href="summarize.html#其他常用的摘要函数"><i class="fa fa-check"></i><b>1.4.4</b> 其他常用的摘要函数</a></li>
<li class="chapter" data-level="1.4.5" data-path="summarize.html"><a href="summarize.html#多个分组变量的消耗"><i class="fa fa-check"></i><b>1.4.5</b> 多个分组变量的消耗</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="group-by-combined-with-other-functions.html"><a href="group-by-combined-with-other-functions.html"><i class="fa fa-check"></i><b>1.5</b> <code>group_by()</code> combined with other functions</a></li>
<li class="chapter" data-level="1.6" data-path="dplyr-exercise.html"><a href="dplyr-exercise.html"><i class="fa fa-check"></i><b>1.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="tibble-modern-data-frames.html"><a href="tibble-modern-data-frames.html"><i class="fa fa-check"></i><b>2</b> tibble: Modern data frames</a><ul>
<li class="chapter" data-level="2.1" data-path="tibble-intro.html"><a href="tibble-intro.html"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="tibble-data-frame.html"><a href="tibble-data-frame.html"><i class="fa fa-check"></i><b>2.2</b> Comparing tibble and data.frame</a><ul>
<li class="chapter" data-level="2.2.1" data-path="tibble-data-frame.html"><a href="tibble-data-frame.html#creating"><i class="fa fa-check"></i><b>2.2.1</b> Creating</a></li>
<li class="chapter" data-level="2.2.2" data-path="tibble-data-frame.html"><a href="tibble-data-frame.html#printing"><i class="fa fa-check"></i><b>2.2.2</b> Printing</a></li>
<li class="chapter" data-level="2.2.3" data-path="tibble-data-frame.html"><a href="tibble-data-frame.html#subsetting"><i class="fa fa-check"></i><b>2.2.3</b> Subsetting</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="comparing-two-data-frames-tibbles.html"><a href="comparing-two-data-frames-tibbles.html"><i class="fa fa-check"></i><b>2.3</b> Comparing two data frames (tibbles)</a><ul>
<li class="chapter" data-level="2.3.1" data-path="comparing-two-data-frames-tibbles.html"><a href="comparing-two-data-frames-tibbles.html#dplyrall_equal"><i class="fa fa-check"></i><b>2.3.1</b> <code>dplyr::all_equal()</code></a></li>
<li class="chapter" data-level="2.3.2" data-path="comparing-two-data-frames-tibbles.html"><a href="comparing-two-data-frames-tibbles.html#janitorcompare_df_cols"><i class="fa fa-check"></i><b>2.3.2</b> <code>janitor::compare_df_cols()</code></a></li>
<li class="chapter" data-level="2.3.3" data-path="comparing-two-data-frames-tibbles.html"><a href="comparing-two-data-frames-tibbles.html#vetralike"><i class="fa fa-check"></i><b>2.3.3</b> <code>vetr::alike()</code></a></li>
<li class="chapter" data-level="2.3.4" data-path="comparing-two-data-frames-tibbles.html"><a href="comparing-two-data-frames-tibbles.html#diffdfdiffdf"><i class="fa fa-check"></i><b>2.3.4</b> <code>diffdf::diffdf()</code></a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="tibble-exercise.html"><a href="tibble-exercise.html"><i class="fa fa-check"></i><b>2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="readr-data-import.html"><a href="readr-data-import.html"><i class="fa fa-check"></i><b>3</b> readr: Data import</a><ul>
<li class="chapter" data-level="3.1" data-path="importing-data-in-base-r.html"><a href="importing-data-in-base-r.html"><i class="fa fa-check"></i><b>3.1</b> Importing data in base R</a></li>
<li class="chapter" data-level="3.2" data-path="importing-data-in-readr.html"><a href="importing-data-in-readr.html"><i class="fa fa-check"></i><b>3.2</b> Importing data in <code>readr</code></a><ul>
<li class="chapter" data-level="3.2.1" data-path="importing-data-in-readr.html"><a href="importing-data-in-readr.html#introduction"><i class="fa fa-check"></i><b>3.2.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2.2" data-path="importing-data-in-readr.html"><a href="importing-data-in-readr.html#writing-data"><i class="fa fa-check"></i><b>3.2.2</b> Writing data</a></li>
<li class="chapter" data-level="3.2.3" data-path="importing-data-in-readr.html"><a href="importing-data-in-readr.html#exercises-3"><i class="fa fa-check"></i><b>3.2.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="parsing-a-vector.html"><a href="parsing-a-vector.html"><i class="fa fa-check"></i><b>3.3</b> Parsing a vector</a><ul>
<li class="chapter" data-level="3.3.1" data-path="parsing-a-vector.html"><a href="parsing-a-vector.html#numeric"><i class="fa fa-check"></i><b>3.3.1</b> Numeric</a></li>
<li class="chapter" data-level="3.3.2" data-path="parsing-a-vector.html"><a href="parsing-a-vector.html#character"><i class="fa fa-check"></i><b>3.3.2</b> Character</a></li>
<li class="chapter" data-level="3.3.3" data-path="parsing-a-vector.html"><a href="parsing-a-vector.html#factor"><i class="fa fa-check"></i><b>3.3.3</b> Factor</a></li>
<li class="chapter" data-level="3.3.4" data-path="parsing-a-vector.html"><a href="parsing-a-vector.html#date-and-time"><i class="fa fa-check"></i><b>3.3.4</b> Date and time</a></li>
<li class="chapter" data-level="3.3.5" data-path="parsing-a-vector.html"><a href="parsing-a-vector.html#exercises-4"><i class="fa fa-check"></i><b>3.3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="parsing-a-file.html"><a href="parsing-a-file.html"><i class="fa fa-check"></i><b>3.4</b> Parsing a file</a><ul>
<li class="chapter" data-level="3.4.1" data-path="parsing-a-file.html"><a href="parsing-a-file.html#strategies"><i class="fa fa-check"></i><b>3.4.1</b> Strategies</a></li>
<li class="chapter" data-level="3.4.2" data-path="parsing-a-file.html"><a href="parsing-a-file.html#possible-challenges"><i class="fa fa-check"></i><b>3.4.2</b> Possible challenges</a></li>
<li class="chapter" data-level="3.4.3" data-path="parsing-a-file.html"><a href="parsing-a-file.html#other-tips"><i class="fa fa-check"></i><b>3.4.3</b> Other tips</a></li>
<li class="chapter" data-level="3.4.4" data-path="parsing-a-file.html"><a href="parsing-a-file.html#example-dealing-with-metadata"><i class="fa fa-check"></i><b>3.4.4</b> Example: Dealing with metadata</a></li>
<li class="chapter" data-level="3.4.5" data-path="parsing-a-file.html"><a href="parsing-a-file.html#example-multi-row-headers"><i class="fa fa-check"></i><b>3.4.5</b> Example: multi-row headers</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="readxl.html"><a href="readxl.html"><i class="fa fa-check"></i><b>3.5</b> <code>readxl</code></a><ul>
<li class="chapter" data-level="3.5.1" data-path="readxl.html"><a href="readxl.html#multi-row-headers-in-excel"><i class="fa fa-check"></i><b>3.5.1</b> Multi-row headers in Excel</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="lubridate-dates-and-times.html"><a href="lubridate-dates-and-times.html"><i class="fa fa-check"></i><b>4</b> lubridate: Dates and times</a><ul>
<li class="chapter" data-level="4.1" data-path="creating-dates-and-times.html"><a href="creating-dates-and-times.html"><i class="fa fa-check"></i><b>4.1</b> Creating dates and times</a><ul>
<li class="chapter" data-level="4.1.1" data-path="creating-dates-and-times.html"><a href="creating-dates-and-times.html#from-strings"><i class="fa fa-check"></i><b>4.1.1</b> From strings</a></li>
<li class="chapter" data-level="4.1.2" data-path="creating-dates-and-times.html"><a href="creating-dates-and-times.html#from-individual-components"><i class="fa fa-check"></i><b>4.1.2</b> From individual components</a></li>
<li class="chapter" data-level="4.1.3" data-path="creating-dates-and-times.html"><a href="creating-dates-and-times.html#from-other-times"><i class="fa fa-check"></i><b>4.1.3</b> From other times</a></li>
<li class="chapter" data-level="4.1.4" data-path="creating-dates-and-times.html"><a href="creating-dates-and-times.html#exercises-5"><i class="fa fa-check"></i><b>4.1.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="date-time-components.html"><a href="date-time-components.html"><i class="fa fa-check"></i><b>4.2</b> Date-time components</a><ul>
<li class="chapter" data-level="4.2.1" data-path="date-time-components.html"><a href="date-time-components.html#accessing-components"><i class="fa fa-check"></i><b>4.2.1</b> Accessing components</a></li>
<li class="chapter" data-level="4.2.2" data-path="date-time-components.html"><a href="date-time-components.html#rounding"><i class="fa fa-check"></i><b>4.2.2</b> Rounding</a></li>
<li class="chapter" data-level="4.2.3" data-path="date-time-components.html"><a href="date-time-components.html#setting-components"><i class="fa fa-check"></i><b>4.2.3</b> Setting components</a></li>
<li class="chapter" data-level="4.2.4" data-path="date-time-components.html"><a href="date-time-components.html#exercises-6"><i class="fa fa-check"></i><b>4.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="time-span.html"><a href="time-span.html"><i class="fa fa-check"></i><b>4.3</b> Time span</a><ul>
<li class="chapter" data-level="4.3.1" data-path="time-span.html"><a href="time-span.html#时期-durations"><i class="fa fa-check"></i><b>4.3.1</b> 时期 Durations</a></li>
<li class="chapter" data-level="4.3.2" data-path="time-span.html"><a href="time-span.html#阶段-periods"><i class="fa fa-check"></i><b>4.3.2</b> 阶段 Periods</a></li>
<li class="chapter" data-level="4.3.3" data-path="time-span.html"><a href="time-span.html#区间-intervals"><i class="fa fa-check"></i><b>4.3.3</b> 区间 Intervals</a></li>
<li class="chapter" data-level="4.3.4" data-path="time-span.html"><a href="time-span.html#conclusion"><i class="fa fa-check"></i><b>4.3.4</b> Conclusion</a></li>
<li class="chapter" data-level="4.3.5" data-path="time-span.html"><a href="time-span.html#exercises-7"><i class="fa fa-check"></i><b>4.3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="hms.html"><a href="hms.html"><i class="fa fa-check"></i><b>4.4</b> hms</a></li>
<li class="chapter" data-level="4.5" data-path="dint.html"><a href="dint.html"><i class="fa fa-check"></i><b>4.5</b> dint</a><ul>
<li class="chapter" data-level="4.5.1" data-path="dint.html"><a href="dint.html#creation"><i class="fa fa-check"></i><b>4.5.1</b> Creation</a></li>
<li class="chapter" data-level="4.5.2" data-path="dint.html"><a href="dint.html#arithmetic-and-sequences"><i class="fa fa-check"></i><b>4.5.2</b> Arithmetic and Sequences</a></li>
<li class="chapter" data-level="4.5.3" data-path="dint.html"><a href="dint.html#accessors"><i class="fa fa-check"></i><b>4.5.3</b> Accessors</a></li>
<li class="chapter" data-level="4.5.4" data-path="dint.html"><a href="dint.html#formatting"><i class="fa fa-check"></i><b>4.5.4</b> Formatting</a></li>
<li class="chapter" data-level="4.5.5" data-path="dint.html"><a href="dint.html#labelling-functions-in-ggplot2"><i class="fa fa-check"></i><b>4.5.5</b> Labelling functions in ggplot2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="forcats-factor.html"><a href="forcats-factor.html"><i class="fa fa-check"></i><b>5</b> forcats: factor</a><ul>
<li class="chapter" data-level="5.1" data-path="factor-basics.html"><a href="factor-basics.html"><i class="fa fa-check"></i><b>5.1</b> Factor basics</a></li>
<li class="chapter" data-level="5.2" data-path="sorting.html"><a href="sorting.html"><i class="fa fa-check"></i><b>5.2</b> Sorting</a><ul>
<li class="chapter" data-level="5.2.1" data-path="sorting.html"><a href="sorting.html#sorting-by-frequency-appearance-or-numeric-order"><i class="fa fa-check"></i><b>5.2.1</b> Sorting by frequency, appearance, or numeric order</a></li>
<li class="chapter" data-level="5.2.2" data-path="sorting.html"><a href="sorting.html#sorting-by-another-variable"><i class="fa fa-check"></i><b>5.2.2</b> Sorting by another variable</a></li>
<li class="chapter" data-level="5.2.3" data-path="sorting.html"><a href="sorting.html#sorting-manually"><i class="fa fa-check"></i><b>5.2.3</b> Sorting manually</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="chaninge-number-of-levels.html"><a href="chaninge-number-of-levels.html"><i class="fa fa-check"></i><b>5.3</b> Chaninge number of levels</a><ul>
<li class="chapter" data-level="5.3.1" data-path="chaninge-number-of-levels.html"><a href="chaninge-number-of-levels.html#lumping-levels"><i class="fa fa-check"></i><b>5.3.1</b> Lumping levels</a></li>
<li class="chapter" data-level="5.3.2" data-path="chaninge-number-of-levels.html"><a href="chaninge-number-of-levels.html#expanding-levels"><i class="fa fa-check"></i><b>5.3.2</b> Expanding levels</a></li>
<li class="chapter" data-level="5.3.3" data-path="chaninge-number-of-levels.html"><a href="chaninge-number-of-levels.html#dropping-levels"><i class="fa fa-check"></i><b>5.3.3</b> Dropping levels</a></li>
<li class="chapter" data-level="5.3.4" data-path="chaninge-number-of-levels.html"><a href="chaninge-number-of-levels.html#transforming-na-levels"><i class="fa fa-check"></i><b>5.3.4</b> Transforming NA levels</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="recoding.html"><a href="recoding.html"><i class="fa fa-check"></i><b>5.4</b> Recoding</a><ul>
<li class="chapter" data-level="5.4.1" data-path="recoding.html"><a href="recoding.html#exercises-8"><i class="fa fa-check"></i><b>5.4.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="tidyr-tidy-data.html"><a href="tidyr-tidy-data.html"><i class="fa fa-check"></i><b>6</b> tidyr: Tidy data</a><ul>
<li class="chapter" data-level="6.1" data-path="tidyr-intro.html"><a href="tidyr-intro.html"><i class="fa fa-check"></i><b>6.1</b> Tidy data</a><ul>
<li class="chapter" data-level="6.1.1" data-path="tidyr-intro.html"><a href="tidyr-intro.html#exercises-9"><i class="fa fa-check"></i><b>6.1.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="pivoting.html"><a href="pivoting.html"><i class="fa fa-check"></i><b>6.2</b> Pivoting</a><ul>
<li class="chapter" data-level="6.2.1" data-path="pivoting.html"><a href="pivoting.html#pivot_longer"><i class="fa fa-check"></i><b>6.2.1</b> <code>pivot_longer()</code></a></li>
<li class="chapter" data-level="6.2.2" data-path="pivoting.html"><a href="pivoting.html#pivot_wider"><i class="fa fa-check"></i><b>6.2.2</b> <code>pivot_wider()</code></a></li>
<li class="chapter" data-level="6.2.3" data-path="pivoting.html"><a href="pivoting.html#combining-pivot_longer-and-pivot_wider"><i class="fa fa-check"></i><b>6.2.3</b> Combining <code>pivot_longer()</code> and <code>pivot_wider()</code></a></li>
<li class="chapter" data-level="6.2.4" data-path="pivoting.html"><a href="pivoting.html#exercises-10"><i class="fa fa-check"></i><b>6.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="nesting.html"><a href="nesting.html"><i class="fa fa-check"></i><b>6.3</b> Nesting</a><ul>
<li class="chapter" data-level="6.3.1" data-path="nesting.html"><a href="nesting.html#example-managing-multiple-models"><i class="fa fa-check"></i><b>6.3.1</b> Example: Managing multiple models</a></li>
<li class="chapter" data-level="6.3.2" data-path="nesting.html"><a href="nesting.html#multi-choice"><i class="fa fa-check"></i><b>6.3.2</b> Example: Multicple hoice data</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="rectangling.html"><a href="rectangling.html"><i class="fa fa-check"></i><b>6.4</b> Rectangling</a><ul>
<li class="chapter" data-level="6.4.1" data-path="rectangling.html"><a href="rectangling.html#github-users"><i class="fa fa-check"></i><b>6.4.1</b> Github users</a></li>
<li class="chapter" data-level="6.4.2" data-path="rectangling.html"><a href="rectangling.html#github-repos"><i class="fa fa-check"></i><b>6.4.2</b> Github repos</a></li>
<li class="chapter" data-level="6.4.3" data-path="rectangling.html"><a href="rectangling.html#game-of-throne-characters"><i class="fa fa-check"></i><b>6.4.3</b> Game of Throne characters</a></li>
<li class="chapter" data-level="6.4.4" data-path="rectangling.html"><a href="rectangling.html#sharla-gelfands-discography"><i class="fa fa-check"></i><b>6.4.4</b> Sharla Gelfand’s discography</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="separate-and-untie.html"><a href="separate-and-untie.html"><i class="fa fa-check"></i><b>6.5</b> <code>separate()</code> and <code>untie()</code></a><ul>
<li class="chapter" data-level="6.5.1" data-path="separate-and-untie.html"><a href="separate-and-untie.html#separate"><i class="fa fa-check"></i><b>6.5.1</b> <code>separate()</code></a></li>
<li class="chapter" data-level="6.5.2" data-path="separate-and-untie.html"><a href="separate-and-untie.html#unite"><i class="fa fa-check"></i><b>6.5.2</b> <code>unite()</code></a></li>
<li class="chapter" data-level="6.5.3" data-path="separate-and-untie.html"><a href="separate-and-untie.html#exercises-11"><i class="fa fa-check"></i><b>6.5.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="tidyr-missing.html"><a href="tidyr-missing.html"><i class="fa fa-check"></i><b>6.6</b> Handling missing values</a></li>
<li class="chapter" data-level="6.7" data-path="tidyr-case.html"><a href="tidyr-case.html"><i class="fa fa-check"></i><b>6.7</b> Case Study</a></li>
<li class="chapter" data-level="6.8" data-path="miscellaneous-functions.html"><a href="miscellaneous-functions.html"><i class="fa fa-check"></i><b>6.8</b> Miscellaneous Functions</a><ul>
<li class="chapter" data-level="6.8.1" data-path="miscellaneous-functions.html"><a href="miscellaneous-functions.html#chop-and-unchop"><i class="fa fa-check"></i><b>6.8.1</b> <code>chop()</code> and <code>unchop()</code></a></li>
<li class="chapter" data-level="6.8.2" data-path="miscellaneous-functions.html"><a href="miscellaneous-functions.html#uncount"><i class="fa fa-check"></i><b>6.8.2</b> <code>uncount()</code></a></li>
<li class="chapter" data-level="6.8.3" data-path="miscellaneous-functions.html"><a href="miscellaneous-functions.html#exercises-12"><i class="fa fa-check"></i><b>6.8.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="non-tidy.html"><a href="non-tidy.html"><i class="fa fa-check"></i><b>6.9</b> None-tidy data</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="purrr-functional-programming.html"><a href="purrr-functional-programming.html"><i class="fa fa-check"></i><b>7</b> purrr: Functional programming</a><ul>
<li class="chapter" data-level="7.1" data-path="map-family.html"><a href="map-family.html"><i class="fa fa-check"></i><b>7.1</b> <code>map()</code> family</a></li>
<li class="chapter" data-level="7.2" data-path="producing-atomic-vectors.html"><a href="producing-atomic-vectors.html"><i class="fa fa-check"></i><b>7.2</b> Producing atomic vectors</a><ul>
<li class="chapter" data-level="7.2.1" data-path="producing-atomic-vectors.html"><a href="producing-atomic-vectors.html#purrr-style-anonymous-functions"><i class="fa fa-check"></i><b>7.2.1</b> purrr-style anonymous functions</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="predicate-functions.html"><a href="predicate-functions.html"><i class="fa fa-check"></i><b>7.3</b> Predicate functions</a><ul>
<li class="chapter" data-level="7.3.1" data-path="predicate-functions.html"><a href="predicate-functions.html#basics"><i class="fa fa-check"></i><b>7.3.1</b> Basics</a></li>
<li class="chapter" data-level="7.3.2" data-path="predicate-functions.html"><a href="predicate-functions.html#map-variants"><i class="fa fa-check"></i><b>7.3.2</b> Map variants</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="group-functions.html"><a href="group-functions.html"><i class="fa fa-check"></i><b>7.4</b> group functions</a><ul>
<li class="chapter" data-level="7.4.1" data-path="group-functions.html"><a href="group-functions.html#group_mapgroup_modify"><i class="fa fa-check"></i><b>7.4.1</b> group_map、group_modify</a></li>
<li class="chapter" data-level="7.4.2" data-path="group-functions.html"><a href="group-functions.html#group_nestgroup_splitgroup_keysgroup_data"><i class="fa fa-check"></i><b>7.4.2</b> group_nest、group_split、group_keys、group_data</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="other-useful-tools.html"><a href="other-useful-tools.html"><i class="fa fa-check"></i><b>7.5</b> Other useful tools</a><ul>
<li class="chapter" data-level="7.5.1" data-path="other-useful-tools.html"><a href="other-useful-tools.html#imap"><i class="fa fa-check"></i><b>7.5.1</b> <code>imap()</code></a></li>
<li class="chapter" data-level="7.5.2" data-path="other-useful-tools.html"><a href="other-useful-tools.html#adverbs"><i class="fa fa-check"></i><b>7.5.2</b> adverbs</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="relational-data.html"><a href="relational-data.html"><i class="fa fa-check"></i><b>8</b> Relational data</a><ul>
<li class="chapter" data-level="8.1" data-path="introduction-1.html"><a href="introduction-1.html"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="mutating-joins.html"><a href="mutating-joins.html"><i class="fa fa-check"></i><b>8.2</b> Mutating joins</a></li>
<li class="chapter" data-level="8.3" data-path="filtering-join.html"><a href="filtering-join.html"><i class="fa fa-check"></i><b>8.3</b> Filtering join</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="broom-tidy-representation-of-models.html"><a href="broom-tidy-representation-of-models.html"><i class="fa fa-check"></i><b>9</b> broom: Tidy representation of models</a><ul>
<li class="chapter" data-level="9.1" data-path="viz-many-models.html"><a href="viz-many-models.html"><i class="fa fa-check"></i><b>9.1</b> Visualizing many models</a></li>
<li class="chapter" data-level="9.2" data-path="examples.html"><a href="examples.html"><i class="fa fa-check"></i><b>9.2</b> Examples</a><ul>
<li class="chapter" data-level="9.2.1" data-path="examples.html"><a href="examples.html#pca"><i class="fa fa-check"></i><b>9.2.1</b> PCA</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="broomextra.html"><a href="broomextra.html"><i class="fa fa-check"></i><b>9.3</b> broomExtra</a></li>
<li class="chapter" data-level="9.4" data-path="ggfortify.html"><a href="ggfortify.html"><i class="fa fa-check"></i><b>9.4</b> ggfortify</a></li>
</ul></li>
<li class="part"><span><b>II Importing</b></span></li>
<li class="chapter" data-level="10" data-path="vroom-fast-reading-of-delimited-files.html"><a href="vroom-fast-reading-of-delimited-files.html"><i class="fa fa-check"></i><b>10</b> vroom: Fast reading of delimited files</a></li>
<li class="chapter" data-level="11" data-path="reading-in-data-from-other-formats.html"><a href="reading-in-data-from-other-formats.html"><i class="fa fa-check"></i><b>11</b> Reading in data from other formats</a><ul>
<li class="chapter" data-level="11.1" data-path="pdf.html"><a href="pdf.html"><i class="fa fa-check"></i><b>11.1</b> PDF</a><ul>
<li class="chapter" data-level="11.1.1" data-path="pdf.html"><a href="pdf.html#scraping-pdf-data"><i class="fa fa-check"></i><b>11.1.1</b> Scraping pdf data</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="office-documents.html"><a href="office-documents.html"><i class="fa fa-check"></i><b>11.2</b> Office documents</a></li>
<li class="chapter" data-level="11.3" data-path="google-sheet.html"><a href="google-sheet.html"><i class="fa fa-check"></i><b>11.3</b> Google sheet</a></li>
<li class="chapter" data-level="11.4" data-path="images.html"><a href="images.html"><i class="fa fa-check"></i><b>11.4</b> Images</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="useful-apis.html"><a href="useful-apis.html"><i class="fa fa-check"></i><b>12</b> Useful APIs</a><ul>
<li class="chapter" data-level="12.1" data-path="wdi.html"><a href="wdi.html"><i class="fa fa-check"></i><b>12.1</b> WDI</a><ul>
<li class="chapter" data-level="12.1.1" data-path="wdi.html"><a href="wdi.html#wdisearch"><i class="fa fa-check"></i><b>12.1.1</b> <code>WDIsearch()</code></a></li>
<li class="chapter" data-level="12.1.2" data-path="wdi.html"><a href="wdi.html#wdi-1"><i class="fa fa-check"></i><b>12.1.2</b> <code>WDI</code></a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="ipumsr.html"><a href="ipumsr.html"><i class="fa fa-check"></i><b>12.2</b> ipumsr</a></li>
</ul></li>
<li class="part"><span><b>III Exploring and Wrangling</b></span></li>
<li class="chapter" data-level="13" data-path="data-summary.html"><a href="data-summary.html"><i class="fa fa-check"></i><b>13</b> Data summary</a><ul>
<li class="chapter" data-level="13.1" data-path="skimr.html"><a href="skimr.html"><i class="fa fa-check"></i><b>13.1</b> skimr</a></li>
<li class="chapter" data-level="13.2" data-path="visdat.html"><a href="visdat.html"><i class="fa fa-check"></i><b>13.2</b> visdat</a></li>
<li class="chapter" data-level="13.3" data-path="summarytools.html"><a href="summarytools.html"><i class="fa fa-check"></i><b>13.3</b> summarytools</a><ul>
<li class="chapter" data-level="13.3.1" data-path="summarytools.html"><a href="summarytools.html#freq"><i class="fa fa-check"></i><b>13.3.1</b> <code>freq</code></a></li>
<li class="chapter" data-level="13.3.2" data-path="summarytools.html"><a href="summarytools.html#descr"><i class="fa fa-check"></i><b>13.3.2</b> <code>descr()</code></a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="gt-and-gtsummary.html"><a href="gt-and-gtsummary.html"><i class="fa fa-check"></i><b>13.4</b> gt and gtsummary</a></li>
<li class="chapter" data-level="13.5" data-path="naniar.html"><a href="naniar.html"><i class="fa fa-check"></i><b>13.5</b> naniar</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="janitor.html"><a href="janitor.html"><i class="fa fa-check"></i><b>14</b> Janitor</a><ul>
<li class="chapter" data-level="14.1" data-path="janitor-cleaning.html"><a href="janitor-cleaning.html"><i class="fa fa-check"></i><b>14.1</b> cleaning</a><ul>
<li class="chapter" data-level="14.1.1" data-path="janitor-cleaning.html"><a href="janitor-cleaning.html#clean_names"><i class="fa fa-check"></i><b>14.1.1</b> <code>clean_names</code></a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="janitor-explore.html"><a href="janitor-explore.html"><i class="fa fa-check"></i><b>14.2</b> Exploring</a><ul>
<li class="chapter" data-level="14.2.1" data-path="janitor-explore.html"><a href="janitor-explore.html#tabyl"><i class="fa fa-check"></i><b>14.2.1</b> <code>tabyl</code></a></li>
<li class="chapter" data-level="14.2.2" data-path="janitor-explore.html"><a href="janitor-explore.html#get_dupes"><i class="fa fa-check"></i><b>14.2.2</b> <code>get_dupes</code></a></li>
<li class="chapter" data-level="14.2.3" data-path="janitor-explore.html"><a href="janitor-explore.html#remove_"><i class="fa fa-check"></i><b>14.2.3</b> <code>remove_</code></a></li>
<li class="chapter" data-level="14.2.4" data-path="janitor-explore.html"><a href="janitor-explore.html#round_half_up"><i class="fa fa-check"></i><b>14.2.4</b> <code>round_half_up</code></a></li>
<li class="chapter" data-level="14.2.5" data-path="janitor-explore.html"><a href="janitor-explore.html#excel_numeric_to_date"><i class="fa fa-check"></i><b>14.2.5</b> <code>excel_numeric_to_date</code></a></li>
<li class="chapter" data-level="14.2.6" data-path="janitor-explore.html"><a href="janitor-explore.html#top_levels"><i class="fa fa-check"></i><b>14.2.6</b> <code>top_levels</code></a></li>
<li class="chapter" data-level="14.2.7" data-path="janitor-explore.html"><a href="janitor-explore.html#row_to_names"><i class="fa fa-check"></i><b>14.2.7</b> <code>row_to_names</code></a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Miscellaneous tools</b></span></li>
<li class="chapter" data-level="15" data-path="advanced-relational-data.html"><a href="advanced-relational-data.html"><i class="fa fa-check"></i><b>15</b> Advanced relational data</a><ul>
<li class="chapter" data-level="15.1" data-path="fuzzyjoin.html"><a href="fuzzyjoin.html"><i class="fa fa-check"></i><b>15.1</b> fuzzyjoin</a><ul>
<li class="chapter" data-level="15.1.1" data-path="fuzzyjoin.html"><a href="fuzzyjoin.html#inexact-matching"><i class="fa fa-check"></i><b>15.1.1</b> inexact matching</a></li>
<li class="chapter" data-level="15.1.2" data-path="fuzzyjoin.html"><a href="fuzzyjoin.html#stringdist"><i class="fa fa-check"></i><b>15.1.2</b> stringdist</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="funneljoin.html"><a href="funneljoin.html"><i class="fa fa-check"></i><b>15.2</b> funneljoin</a><ul>
<li class="chapter" data-level="15.2.1" data-path="funneljoin.html"><a href="funneljoin.html#after_join"><i class="fa fa-check"></i><b>15.2.1</b> <code>after_join()</code></a></li>
<li class="chapter" data-level="15.2.2" data-path="funneljoin.html"><a href="funneljoin.html#funnel-in-one-table"><i class="fa fa-check"></i><b>15.2.2</b> funnel in one table</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="dm.html"><a href="dm.html"><i class="fa fa-check"></i><b>15.3</b> dm</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="categorical-data-facotr.html"><a href="categorical-data-facotr.html"><i class="fa fa-check"></i><b>16</b> Categorical data (facotr)</a><ul>
<li class="chapter" data-level="16.1" data-path="frequency-and-contingency-table.html"><a href="frequency-and-contingency-table.html"><i class="fa fa-check"></i><b>16.1</b> Frequency and contingency table</a><ul>
<li class="chapter" data-level="16.1.1" data-path="frequency-and-contingency-table.html"><a href="frequency-and-contingency-table.html#frq-and-flat_table"><i class="fa fa-check"></i><b>16.1.1</b> <code>frq()</code> and <code>flat_table()</code></a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="coding.html"><a href="coding.html"><i class="fa fa-check"></i><b>16.2</b> Coding</a><ul>
<li class="chapter" data-level="16.2.1" data-path="coding.html"><a href="coding.html#rec"><i class="fa fa-check"></i><b>16.2.1</b> <code>rec()</code></a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="cutting.html"><a href="cutting.html"><i class="fa fa-check"></i><b>16.3</b> Cutting</a><ul>
<li class="chapter" data-level="16.3.1" data-path="cutting.html"><a href="cutting.html#chop"><i class="fa fa-check"></i><b>16.3.1</b> <code>chop()</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="dealing-with-missing-values.html"><a href="dealing-with-missing-values.html"><i class="fa fa-check"></i><b>17</b> Dealing with missing values</a><ul>
<li class="chapter" data-level="17.1" data-path="explore-missing.html"><a href="explore-missing.html"><i class="fa fa-check"></i><b>17.1</b> Exploring</a><ul>
<li class="chapter" data-level="17.1.1" data-path="explore-missing.html"><a href="explore-missing.html#naniar-1"><i class="fa fa-check"></i><b>17.1.1</b> naniar</a></li>
<li class="chapter" data-level="17.1.2" data-path="explore-missing.html"><a href="explore-missing.html#replace-a-value-with-na"><i class="fa fa-check"></i><b>17.1.2</b> Replace a value with NA</a></li>
<li class="chapter" data-level="17.1.3" data-path="explore-missing.html"><a href="explore-missing.html#janitor-1"><i class="fa fa-check"></i><b>17.1.3</b> janitor</a></li>
<li class="chapter" data-level="17.1.4" data-path="explore-missing.html"><a href="explore-missing.html#sjmisc"><i class="fa fa-check"></i><b>17.1.4</b> sjmisc</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="wrangling.html"><a href="wrangling.html"><i class="fa fa-check"></i><b>17.2</b> Wrangling</a><ul>
<li class="chapter" data-level="17.2.1" data-path="wrangling.html"><a href="wrangling.html#tidyr"><i class="fa fa-check"></i><b>17.2.1</b> tidyr</a></li>
<li class="chapter" data-level="17.2.2" data-path="wrangling.html"><a href="wrangling.html#janitor-2"><i class="fa fa-check"></i><b>17.2.2</b> janitor</a></li>
<li class="chapter" data-level="17.2.3" data-path="wrangling.html"><a href="wrangling.html#visdat-1"><i class="fa fa-check"></i><b>17.2.3</b> visdat</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="imputation.html"><a href="imputation.html"><i class="fa fa-check"></i><b>17.3</b> Imputation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">written with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R for data science: tidyverse and beyond</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="parsing-a-file" class="section level2">
<h2><span class="header-section-number">3.4</span> Parsing a file</h2>
<p>现在我们已经学会了如何用 <code>parse_*()</code> 函数族解析单个向量，接下来就能回到本章的最初目标，研究<code>readr</code>是如何解析文件的。我们将关注以下两点：</p>
<ul>
<li><code>readr</code>如何自动猜出文件每列的数据类型<br />
</li>
<li>如何修改默认设置</li>
</ul>
<div id="strategies" class="section level3">
<h3><span class="header-section-number">3.4.1</span> Strategies</h3>
<p><code>readr</code> 通过一种启发式过程(heuristic)来确定每列的类型：先读取文件的前1000行，然后使用（相对保守的）某种启发式算法确定每列的类型。<code>readr</code> 中的导入函数会先用 <code>guess_parser()</code> 函数返回对于所需解析函数最可信的猜测，然后尝试用可能性最大的解析函数解析该列：</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb197-1" title="1"><span class="kw">guess_parser</span>(<span class="st">&quot;123.45&quot;</span>)</a>
<a class="sourceLine" id="cb197-2" title="2"><span class="co">#&gt; [1] &quot;double&quot;</span></a>
<a class="sourceLine" id="cb197-3" title="3"><span class="kw">guess_parser</span>(<span class="st">&quot;12,352,561&quot;</span>)</a>
<a class="sourceLine" id="cb197-4" title="4"><span class="co">#&gt; [1] &quot;number&quot;</span></a>
<a class="sourceLine" id="cb197-5" title="5"><span class="kw">guess_parser</span>(<span class="st">&quot;1998-11-12&quot;</span>)</a>
<a class="sourceLine" id="cb197-6" title="6"><span class="co">#&gt; [1] &quot;date&quot;</span></a>
<a class="sourceLine" id="cb197-7" title="7"><span class="kw">guess_parser</span>(<span class="kw">c</span>(<span class="st">&quot;True&quot;</span>, <span class="st">&quot;False&quot;</span>))</a>
<a class="sourceLine" id="cb197-8" title="8"><span class="co">#&gt; [1] &quot;logical&quot;</span></a></code></pre></div>
<p>这个过程会依次尝试以下每种数据类型，直到找到匹配的类型。</p>
<p><strong>逻辑值(logical)</strong>：<br />
只包括<code>F</code>、<code>T</code>、<code>FALSE</code>和<code>True</code><br />
<strong>整数(integer)</strong><br />
只包括数值型字符（以及<code>-</code>）<br />
<strong>双精度浮点数(double)</strong><br />
只包括有效的双精度浮点数<br />
<strong>数值(number)</strong><br />
只包括带有分组符号的有效双精度浮点数<br />
<strong>时间</strong><br />
与默认的<code>time_format</code>匹配的值<br />
<strong>日期</strong><br />
与默认的<code>date_format</code>匹配的值<br />
<strong>日期时间</strong><br />
符合ISO 8601标准的任何日期</p>
<p>如果以上数据不符合上述要求中的任意一个，那么这一列就是一个字符串向量，<code>readr</code>将使用<code>parse_character()</code>解析它。</p>
</div>
<div id="possible-challenges" class="section level3">
<h3><span class="header-section-number">3.4.2</span> Possible challenges</h3>
<p>这些默认设置对更大的文件并不总是有效。以下是两个可能遇到的主要问题：</p>
<ul>
<li><code>readr</code> 通过前 1000 行猜测数据类型，但是前 1000 行可能只是一种特殊情况，不足以代表整列。例如，一列双精度数值的前1000行有可能都是整数<br />
</li>
<li>列中可能包含大量缺失值。如果前 1000 行都是 <code>NA</code>，那么<code>readr</code> 会认为这是一个字符向量，但你其实想将这一类解析为更具体的值。</li>
</ul>
<p><code>readr</code>的安装包里包含了一份文件<code>challenge.csv</code>，用来说明解析过程中可能遇到的问题。这个csv文件包含两列x，y和2001行观测。x 列的前 1001 行均为整数，但之后的值均为双精度整数。y 列的前 1001 行均为<code>NA</code>，后面是日期型数据：</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb198-1" title="1"><span class="co"># readr_example() find path for a built-in readr file</span></a>
<a class="sourceLine" id="cb198-2" title="2">challenge &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="kw">readr_example</span>(<span class="st">&quot;challenge.csv&quot;</span>))</a>
<a class="sourceLine" id="cb198-3" title="3"><span class="co">#&gt; Parsed with column specification:</span></a>
<a class="sourceLine" id="cb198-4" title="4"><span class="co">#&gt; cols(</span></a>
<a class="sourceLine" id="cb198-5" title="5"><span class="co">#&gt;   x = col_double(),</span></a>
<a class="sourceLine" id="cb198-6" title="6"><span class="co">#&gt;   y = col_logical()</span></a>
<a class="sourceLine" id="cb198-7" title="7"><span class="co">#&gt; )</span></a></code></pre></div>
<p>可以看到，<code>read_csv()</code> 成功解析了 <code>x</code>，但对于 <code>y</code> 则无从下手，因为使用了错误的解析函数<code>col_logical()</code>。使用 <code>problems()</code> 函数明确列出这些失败记录，以便深入探究其中的问题：</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb199-1" title="1"><span class="kw">problems</span>(challenge)</a>
<a class="sourceLine" id="cb199-2" title="2"><span class="co">#&gt; # A tibble: 1,000 x 5</span></a>
<a class="sourceLine" id="cb199-3" title="3"><span class="co">#&gt;     row col   expected       actual   file                                      </span></a>
<a class="sourceLine" id="cb199-4" title="4"><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt; &lt;chr&gt;          &lt;chr&gt;    &lt;chr&gt;                                     </span></a>
<a class="sourceLine" id="cb199-5" title="5"><span class="co">#&gt; 1  1001 y     1/0/T/F/TRUE/~ 2015-01~ &#39;C:/Users/Lenovo/Documents/R/win-library/~</span></a>
<a class="sourceLine" id="cb199-6" title="6"><span class="co">#&gt; 2  1002 y     1/0/T/F/TRUE/~ 2018-05~ &#39;C:/Users/Lenovo/Documents/R/win-library/~</span></a>
<a class="sourceLine" id="cb199-7" title="7"><span class="co">#&gt; 3  1003 y     1/0/T/F/TRUE/~ 2015-09~ &#39;C:/Users/Lenovo/Documents/R/win-library/~</span></a>
<a class="sourceLine" id="cb199-8" title="8"><span class="co">#&gt; 4  1004 y     1/0/T/F/TRUE/~ 2012-11~ &#39;C:/Users/Lenovo/Documents/R/win-library/~</span></a>
<a class="sourceLine" id="cb199-9" title="9"><span class="co">#&gt; 5  1005 y     1/0/T/F/TRUE/~ 2020-01~ &#39;C:/Users/Lenovo/Documents/R/win-library/~</span></a>
<a class="sourceLine" id="cb199-10" title="10"><span class="co">#&gt; 6  1006 y     1/0/T/F/TRUE/~ 2016-04~ &#39;C:/Users/Lenovo/Documents/R/win-library/~</span></a>
<a class="sourceLine" id="cb199-11" title="11"><span class="co">#&gt; # ... with 994 more rows</span></a></code></pre></div>
<p>可以使用<code>spec_csv()</code> 来直接查看 <code>readr</code> 在默认情况下用那种类型的解析函数解析数据：</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb200-1" title="1"><span class="kw">spec_csv</span>(<span class="kw">readr_example</span>(<span class="st">&quot;challenge.csv&quot;</span>))</a>
<a class="sourceLine" id="cb200-2" title="2"><span class="co">#&gt; cols(</span></a>
<a class="sourceLine" id="cb200-3" title="3"><span class="co">#&gt;   x = col_double(),</span></a>
<a class="sourceLine" id="cb200-4" title="4"><span class="co">#&gt;   y = col_logical()</span></a>
<a class="sourceLine" id="cb200-5" title="5"><span class="co">#&gt; )</span></a></code></pre></div>
<p>为了解决这个问题，我们用<code>read_csv()</code>函数中的<code>col_types</code>指定每列的解析方法(column specification)，之前我们向<code>col_types</code>传入一个字符串说明各列的类别，但这里是要直接指明解析函数了。这样做的指定必须通过<code>cols()</code>函数来创建(具体格式和<code>spec_csv()</code>或者<code>read_csv()</code>自动打印的说明是一样的)：</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb201-1" title="1">challenge &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="kw">readr_example</span>(<span class="st">&quot;challenge.csv&quot;</span>),</a>
<a class="sourceLine" id="cb201-2" title="2">                      <span class="dt">col_types =</span><span class="kw">cols</span>(</a>
<a class="sourceLine" id="cb201-3" title="3">                         <span class="dt">x =</span> <span class="kw">col_double</span>(),</a>
<a class="sourceLine" id="cb201-4" title="4">                         <span class="dt">y =</span> <span class="kw">col_date</span>()</a>
<a class="sourceLine" id="cb201-5" title="5">))</a>
<a class="sourceLine" id="cb201-6" title="6"></a>
<a class="sourceLine" id="cb201-7" title="7"><span class="kw">tail</span>(challenge)</a>
<a class="sourceLine" id="cb201-8" title="8"><span class="co">#&gt; # A tibble: 6 x 2</span></a>
<a class="sourceLine" id="cb201-9" title="9"><span class="co">#&gt;       x y         </span></a>
<a class="sourceLine" id="cb201-10" title="10"><span class="co">#&gt;   &lt;dbl&gt; &lt;date&gt;    </span></a>
<a class="sourceLine" id="cb201-11" title="11"><span class="co">#&gt; 1 0.805 2019-11-21</span></a>
<a class="sourceLine" id="cb201-12" title="12"><span class="co">#&gt; 2 0.164 2018-03-29</span></a>
<a class="sourceLine" id="cb201-13" title="13"><span class="co">#&gt; 3 0.472 2014-08-04</span></a>
<a class="sourceLine" id="cb201-14" title="14"><span class="co">#&gt; 4 0.718 2015-08-16</span></a>
<a class="sourceLine" id="cb201-15" title="15"><span class="co">#&gt; 5 0.270 2020-02-04</span></a>
<a class="sourceLine" id="cb201-16" title="16"><span class="co">#&gt; 6 0.608 2019-01-06</span></a></code></pre></div>
<p>每个<code>parse_*()</code>函数都有一个对应的<code>col_*()</code>函数。如果数据已经保存在R的字符向量中，那么可以使用<code>parse_*()</code>，如果要告诉<code>readr</code>如何加载数据，则应该使用<code>col_*()</code>。</p>
<p><strong>The available specifications are: (with string abbreviations in brackets)</strong></p>
<ul>
<li><code>col_logical()</code> [l], containing only T, F, TRUE or FALSE.<br />
</li>
<li><code>col_integer()</code> [i], integers.<br />
</li>
<li><code>col_double()</code> [d], doubles.<br />
</li>
<li><code>col_character()</code> [c], everything else.<br />
</li>
<li><code>col_factor(levels, ordered)</code> [f], a fixed set of values.<br />
</li>
<li><code>col_date(format = "")</code> [D]: with the locale’s date_format.<br />
</li>
<li><code>col_time(format = "")</code> [t]: with the locale’s time_format.<br />
</li>
<li><code>col_datetime(format = "")</code> [T]: ISO8601 date times<br />
</li>
<li><code>col_number()</code> [n], numbers containing the grouping_mark<br />
</li>
<li><code>col_skip()</code> [_, -], don’t import this column.<br />
</li>
<li><code>col_guess()</code> [?], parse using the “best” type based on the input.</li>
</ul>
<p><code>cols_only()</code>代替<code>cols()</code>可以仅指定部分列的解析方式；<code>.default</code>表示未提及的所有列(<code>read_csv()</code>的默认设置可以表示为<code>read_csv( col_type = cols(.default = col_guess()))</code></p>
<p>一旦我们指定了正确的解析函数，问题便迎刃而解。</p>
</div>
<div id="other-tips" class="section level3">
<h3><span class="header-section-number">3.4.3</span> Other tips</h3>
<p>我们再介绍其他几种有注意解析文件的通用技巧：</p>
<ul>
<li>在前面的示例中，如果比默认方式再多检查一行，就可以解析成功：</li>
</ul>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb202-1" title="1">challenge &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="kw">readr_example</span>(<span class="st">&quot;challenge.csv&quot;</span>),</a>
<a class="sourceLine" id="cb202-2" title="2">                      <span class="dt">guess_max =</span> <span class="dv">1001</span>)</a></code></pre></div>
<ul>
<li><code>type_convert()</code> re-convert character columns in existing data frame. This is useful if you need to do some manual munging - you can read the columns in as character, clean it up with (e.g.) regular expressions and then let readr take another stab at parsing it.</li>
</ul>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb203-1" title="1">df &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb203-2" title="2">  <span class="dt">x =</span> <span class="kw">as.character</span>(<span class="kw">runif</span>(<span class="dv">10</span>)),</a>
<a class="sourceLine" id="cb203-3" title="3">  <span class="dt">y =</span> <span class="kw">as.character</span>(<span class="kw">sample</span>(<span class="dv">10</span>)),</a>
<a class="sourceLine" id="cb203-4" title="4">  <span class="dt">z =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb203-5" title="5">)</a>
<a class="sourceLine" id="cb203-6" title="6"></a>
<a class="sourceLine" id="cb203-7" title="7">df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">glimpse</span>()</a>
<a class="sourceLine" id="cb203-8" title="8"><span class="co">#&gt; Rows: 10</span></a>
<a class="sourceLine" id="cb203-9" title="9"><span class="co">#&gt; Columns: 3</span></a>
<a class="sourceLine" id="cb203-10" title="10"><span class="co">#&gt; $ x &lt;chr&gt; &quot;0.78455981053412&quot;, &quot;0.525363321648911&quot;, &quot;0.336503465892747&quot;, &quot;0....</span></a>
<a class="sourceLine" id="cb203-11" title="11"><span class="co">#&gt; $ y &lt;chr&gt; &quot;2&quot;, &quot;10&quot;, &quot;1&quot;, &quot;6&quot;, &quot;8&quot;, &quot;7&quot;, &quot;4&quot;, &quot;5&quot;, &quot;3&quot;, &quot;9&quot;</span></a>
<a class="sourceLine" id="cb203-12" title="12"><span class="co">#&gt; $ z &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE</span></a>
<a class="sourceLine" id="cb203-13" title="13"><span class="co"># note changes in column types</span></a>
<a class="sourceLine" id="cb203-14" title="14">df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">type_convert</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">glimpse</span>()</a>
<a class="sourceLine" id="cb203-15" title="15"><span class="co">#&gt; Parsed with column specification:</span></a>
<a class="sourceLine" id="cb203-16" title="16"><span class="co">#&gt; cols(</span></a>
<a class="sourceLine" id="cb203-17" title="17"><span class="co">#&gt;   x = col_double(),</span></a>
<a class="sourceLine" id="cb203-18" title="18"><span class="co">#&gt;   y = col_double()</span></a>
<a class="sourceLine" id="cb203-19" title="19"><span class="co">#&gt; )</span></a>
<a class="sourceLine" id="cb203-20" title="20"><span class="co">#&gt; Rows: 10</span></a>
<a class="sourceLine" id="cb203-21" title="21"><span class="co">#&gt; Columns: 3</span></a>
<a class="sourceLine" id="cb203-22" title="22"><span class="co">#&gt; $ x &lt;dbl&gt; 0.7846, 0.5254, 0.3365, 0.5136, 0.5227, 0.5568, 0.7613, 0.5780, 0...</span></a>
<a class="sourceLine" id="cb203-23" title="23"><span class="co">#&gt; $ y &lt;dbl&gt; 2, 10, 1, 6, 8, 7, 4, 5, 3, 9</span></a>
<a class="sourceLine" id="cb203-24" title="24"><span class="co">#&gt; $ z &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE</span></a></code></pre></div>
<ul>
<li>如果正在读取一个非常大的文件，那么应该将 <code>n_max</code> 设置为一个较小的数，比如10,000 或者 100,000，这可以让加速重复试验的过程。</li>
</ul>
</div>
<div id="example-dealing-with-metadata" class="section level3">
<h3><span class="header-section-number">3.4.4</span> Example: Dealing with metadata</h3>
<p><a href="https://alison.rbind.io/post/2018-02-23-read-multiple-header-rows/" class="uri">https://alison.rbind.io/post/2018-02-23-read-multiple-header-rows/</a></p>
<p>This dataset is from an article published in PLOS ONE called “Being Sticker Rich: Numerical Context Influences Children’s Sharing Behavior”. In this study, children (ages 3–11) received a small (12, “sticker poor”) or large (30, “sticker rich”) number of stickers, and were then given the opportunity to share their windfall with either one or multiple anonymous recipients.</p>
<p>Data in a plain text editor:<br />
<img src="images/sticker.png" width="830" style="display: block; margin: auto;" /></p>
<p>To read in a <code>.tab</code> file, use <code>read_tsv()</code></p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb204-1" title="1"><span class="co"># https://dataverse.harvard.edu/api/access/datafile/2712105 </span></a>
<a class="sourceLine" id="cb204-2" title="2">stickers &lt;-<span class="st"> </span><span class="kw">read_tsv</span>(<span class="st">&quot;data/sticker.tab&quot;</span>)</a>
<a class="sourceLine" id="cb204-3" title="3"></a>
<a class="sourceLine" id="cb204-4" title="4"><span class="kw">spec</span>(stickers)</a>
<a class="sourceLine" id="cb204-5" title="5"><span class="co">#&gt; cols(</span></a>
<a class="sourceLine" id="cb204-6" title="6"><span class="co">#&gt;   SubjectNumber = col_character(),</span></a>
<a class="sourceLine" id="cb204-7" title="7"><span class="co">#&gt;   Condition = col_character(),</span></a>
<a class="sourceLine" id="cb204-8" title="8"><span class="co">#&gt;   NumberStickers = col_character(),</span></a>
<a class="sourceLine" id="cb204-9" title="9"><span class="co">#&gt;   NumberEnvelopes = col_character(),</span></a>
<a class="sourceLine" id="cb204-10" title="10"><span class="co">#&gt;   Gender = col_character(),</span></a>
<a class="sourceLine" id="cb204-11" title="11"><span class="co">#&gt;   Agemonths = col_double(),</span></a>
<a class="sourceLine" id="cb204-12" title="12"><span class="co">#&gt;   Ageyears = col_double(),</span></a>
<a class="sourceLine" id="cb204-13" title="13"><span class="co">#&gt;   Agegroups = col_character(),</span></a>
<a class="sourceLine" id="cb204-14" title="14"><span class="co">#&gt;   `Subject&#39;sEnvelope` = col_character(),</span></a>
<a class="sourceLine" id="cb204-15" title="15"><span class="co">#&gt;   LeftEnvelope = col_character(),</span></a>
<a class="sourceLine" id="cb204-16" title="16"><span class="co">#&gt;   RightEnvelope = col_character(),</span></a>
<a class="sourceLine" id="cb204-17" title="17"><span class="co">#&gt;   `absolutenumberofstickersgiven(Conditions1or3:Outof12;Conditions2or4:Outof30)` = col_character(),</span></a>
<a class="sourceLine" id="cb204-18" title="18"><span class="co">#&gt;   `PercentGiven(Outof100percent)` = col_character(),</span></a>
<a class="sourceLine" id="cb204-19" title="19"><span class="co">#&gt;   Giveornot = col_character(),</span></a>
<a class="sourceLine" id="cb204-20" title="20"><span class="co">#&gt;   LargerEnvelopeabs = col_character(),</span></a>
<a class="sourceLine" id="cb204-21" title="21"><span class="co">#&gt;   LargeEnvelopepercent = col_character(),</span></a>
<a class="sourceLine" id="cb204-22" title="22"><span class="co">#&gt;   SmallerEnvelopeabs = col_character(),</span></a>
<a class="sourceLine" id="cb204-23" title="23"><span class="co">#&gt;   SmallEnvelopepercent = col_character()</span></a>
<a class="sourceLine" id="cb204-24" title="24"><span class="co">#&gt; )</span></a></code></pre></div>
<p>The problem here is that the second row is actually metadata or descriptions about each column header. But this make <code>read_tsv()</code> recognize as character type many of our columns. To verify this, see the first and last 6 rows:</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb205-1" title="1"><span class="kw">head</span>(stickers) </a>
<a class="sourceLine" id="cb205-2" title="2"><span class="co">#&gt; # A tibble: 6 x 18</span></a>
<a class="sourceLine" id="cb205-3" title="3"><span class="co">#&gt;   SubjectNumber Condition NumberStickers NumberEnvelopes Gender Agemonths</span></a>
<a class="sourceLine" id="cb205-4" title="4"><span class="co">#&gt;   &lt;chr&gt;         &lt;chr&gt;     &lt;chr&gt;          &lt;chr&gt;           &lt;chr&gt;      &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb205-5" title="5"><span class="co">#&gt; 1 [Included Sa~ 1=12:1; ~ 1=12; 2=30     1=1 recipient;~ 1=fem~        NA</span></a>
<a class="sourceLine" id="cb205-6" title="6"><span class="co">#&gt; 2 1             1         1              1               1             36</span></a>
<a class="sourceLine" id="cb205-7" title="7"><span class="co">#&gt; 3 2             1         1              1               2             36</span></a>
<a class="sourceLine" id="cb205-8" title="8"><span class="co">#&gt; 4 3             1         1              1               2             36</span></a>
<a class="sourceLine" id="cb205-9" title="9"><span class="co">#&gt; 5 4             1         1              1               1             36</span></a>
<a class="sourceLine" id="cb205-10" title="10"><span class="co">#&gt; 6 5             1         1              1               2             36</span></a>
<a class="sourceLine" id="cb205-11" title="11"><span class="co">#&gt; # ... with 12 more variables: Ageyears &lt;dbl&gt;, Agegroups &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb205-12" title="12"><span class="co">#&gt; #   `Subject&#39;sEnvelope` &lt;chr&gt;, LeftEnvelope &lt;chr&gt;, RightEnvelope &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb205-13" title="13"><span class="co">#&gt; #   `absolutenumberofstickersgiven(Conditions1or3:Outof12;Conditions2or4:Outof30)` &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb205-14" title="14"><span class="co">#&gt; #   `PercentGiven(Outof100percent)` &lt;chr&gt;, Giveornot &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb205-15" title="15"><span class="co">#&gt; #   LargerEnvelopeabs &lt;chr&gt;, LargeEnvelopepercent &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb205-16" title="16"><span class="co">#&gt; #   SmallerEnvelopeabs &lt;chr&gt;, SmallEnvelopepercent &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb205-17" title="17"><span class="kw">tail</span>(stickers)</a>
<a class="sourceLine" id="cb205-18" title="18"><span class="co">#&gt; # A tibble: 6 x 18</span></a>
<a class="sourceLine" id="cb205-19" title="19"><span class="co">#&gt;   SubjectNumber Condition NumberStickers NumberEnvelopes Gender Agemonths</span></a>
<a class="sourceLine" id="cb205-20" title="20"><span class="co">#&gt;   &lt;chr&gt;         &lt;chr&gt;     &lt;chr&gt;          &lt;chr&gt;           &lt;chr&gt;      &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb205-21" title="21"><span class="co">#&gt; 1 396           1         1              1               2            136</span></a>
<a class="sourceLine" id="cb205-22" title="22"><span class="co">#&gt; 2 397           4         2              2               1            136</span></a>
<a class="sourceLine" id="cb205-23" title="23"><span class="co">#&gt; 3 398           1         1              1               1            137</span></a>
<a class="sourceLine" id="cb205-24" title="24"><span class="co">#&gt; 4 399           1         1              1               2            137</span></a>
<a class="sourceLine" id="cb205-25" title="25"><span class="co">#&gt; 5 400           4         2              2               2            139</span></a>
<a class="sourceLine" id="cb205-26" title="26"><span class="co">#&gt; 6 401           3         2              1               1            143</span></a>
<a class="sourceLine" id="cb205-27" title="27"><span class="co">#&gt; # ... with 12 more variables: Ageyears &lt;dbl&gt;, Agegroups &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb205-28" title="28"><span class="co">#&gt; #   `Subject&#39;sEnvelope` &lt;chr&gt;, LeftEnvelope &lt;chr&gt;, RightEnvelope &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb205-29" title="29"><span class="co">#&gt; #   `absolutenumberofstickersgiven(Conditions1or3:Outof12;Conditions2or4:Outof30)` &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb205-30" title="30"><span class="co">#&gt; #   `PercentGiven(Outof100percent)` &lt;chr&gt;, Giveornot &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb205-31" title="31"><span class="co">#&gt; #   LargerEnvelopeabs &lt;chr&gt;, LargeEnvelopepercent &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb205-32" title="32"><span class="co">#&gt; #   SmallerEnvelopeabs &lt;chr&gt;, SmallEnvelopepercent &lt;chr&gt;</span></a></code></pre></div>
<p>To solve this, we will first create a (tidier) character vector of the column names only. Then we’ll read in the actual data and skip the multiple header rows at the top. When we do this, we lose the column names, so we use the character vector of column names we created in the first place instead.</p>
<p>When we set <code>n_max = 0</code> and <code>col_names = TRUE</code>(the default), ony column headers will be read. Then we could ask <code>janitor::clean_names()</code> to produce a tidier set of names:</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb206-1" title="1">sticker_names &lt;-<span class="st"> </span><span class="kw">read_tsv</span>(<span class="st">&quot;data/sticker.tab&quot;</span>, </a>
<a class="sourceLine" id="cb206-2" title="2">                          <span class="dt">n_max =</span> <span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># default: col_names = TRUE</span></a>
<a class="sourceLine" id="cb206-3" title="3"><span class="st">  </span><span class="kw">rename</span>(<span class="st">&quot;stickers_give&quot;</span> =<span class="st">   &#39;absolutenumberofstickersgiven(Conditions1or3:Outof12;Conditions2or4:Outof30)&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb206-4" title="4"><span class="st">  </span>janitor<span class="op">::</span><span class="kw">clean_names</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb206-5" title="5"><span class="st">  </span><span class="kw">names</span>()</a>
<a class="sourceLine" id="cb206-6" title="6"></a>
<a class="sourceLine" id="cb206-7" title="7">sticker_names</a>
<a class="sourceLine" id="cb206-8" title="8"><span class="co">#&gt;  [1] &quot;subject_number&quot;                &quot;condition&quot;                    </span></a>
<a class="sourceLine" id="cb206-9" title="9"><span class="co">#&gt;  [3] &quot;number_stickers&quot;               &quot;number_envelopes&quot;             </span></a>
<a class="sourceLine" id="cb206-10" title="10"><span class="co">#&gt;  [5] &quot;gender&quot;                        &quot;agemonths&quot;                    </span></a>
<a class="sourceLine" id="cb206-11" title="11"><span class="co">#&gt;  [7] &quot;ageyears&quot;                      &quot;agegroups&quot;                    </span></a>
<a class="sourceLine" id="cb206-12" title="12"><span class="co">#&gt;  [9] &quot;subjects_envelope&quot;             &quot;left_envelope&quot;                </span></a>
<a class="sourceLine" id="cb206-13" title="13"><span class="co">#&gt; [11] &quot;right_envelope&quot;                &quot;stickers_give&quot;                </span></a>
<a class="sourceLine" id="cb206-14" title="14"><span class="co">#&gt; [13] &quot;percent_given_outof100percent&quot; &quot;giveornot&quot;                    </span></a>
<a class="sourceLine" id="cb206-15" title="15"><span class="co">#&gt; [15] &quot;larger_envelopeabs&quot;            &quot;large_envelopepercent&quot;        </span></a>
<a class="sourceLine" id="cb206-16" title="16"><span class="co">#&gt; [17] &quot;smaller_envelopeabs&quot;           &quot;small_envelopepercent&quot;</span></a></code></pre></div>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb207-1" title="1">sticker_tidy &lt;-<span class="st"> </span><span class="kw">read_tsv</span>(<span class="st">&quot;data/sticker.tab&quot;</span>,</a>
<a class="sourceLine" id="cb207-2" title="2">                         <span class="dt">col_names =</span> sticker_names,</a>
<a class="sourceLine" id="cb207-3" title="3">                         <span class="dt">skip =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb207-4" title="4"><span class="co"># or </span></a>
<a class="sourceLine" id="cb207-5" title="5"><span class="kw">read_tsv</span>(<span class="st">&quot;data/sticker.tab&quot;</span>,</a>
<a class="sourceLine" id="cb207-6" title="6">          <span class="dt">col_names =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb207-7" title="7">          <span class="dt">skip =</span> <span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb207-8" title="8"><span class="st">  </span><span class="kw">set_names</span>(sticker_names)</a>
<a class="sourceLine" id="cb207-9" title="9"><span class="co">#&gt; # A tibble: 401 x 18</span></a>
<a class="sourceLine" id="cb207-10" title="10"><span class="co">#&gt;   subject_number condition number_stickers number_envelopes gender agemonths</span></a>
<a class="sourceLine" id="cb207-11" title="11"><span class="co">#&gt;            &lt;dbl&gt;     &lt;dbl&gt;           &lt;dbl&gt;            &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb207-12" title="12"><span class="co">#&gt; 1              1         1               1                1      1        36</span></a>
<a class="sourceLine" id="cb207-13" title="13"><span class="co">#&gt; 2              2         1               1                1      2        36</span></a>
<a class="sourceLine" id="cb207-14" title="14"><span class="co">#&gt; 3              3         1               1                1      2        36</span></a>
<a class="sourceLine" id="cb207-15" title="15"><span class="co">#&gt; 4              4         1               1                1      1        36</span></a>
<a class="sourceLine" id="cb207-16" title="16"><span class="co">#&gt; 5              5         1               1                1      2        36</span></a>
<a class="sourceLine" id="cb207-17" title="17"><span class="co">#&gt; 6              6         1               1                1      2        36</span></a>
<a class="sourceLine" id="cb207-18" title="18"><span class="co">#&gt; # ... with 395 more rows, and 12 more variables: ageyears &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb207-19" title="19"><span class="co">#&gt; #   agegroups &lt;dbl&gt;, subjects_envelope &lt;dbl&gt;, left_envelope &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb207-20" title="20"><span class="co">#&gt; #   right_envelope &lt;dbl&gt;, stickers_give &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb207-21" title="21"><span class="co">#&gt; #   percent_given_outof100percent &lt;dbl&gt;, giveornot &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb207-22" title="22"><span class="co">#&gt; #   larger_envelopeabs &lt;dbl&gt;, large_envelopepercent &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb207-23" title="23"><span class="co">#&gt; #   smaller_envelopeabs &lt;dbl&gt;, small_envelopepercent &lt;dbl&gt;</span></a></code></pre></div>
<p>What if we want to include that meta data? Create a variable description column use <code>pivot_longer()</code></p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb208-1" title="1">sticker_dict &lt;-<span class="st"> </span><span class="kw">read_tsv</span>(<span class="st">&quot;data/sticker.tab&quot;</span>, <span class="dt">n_max =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb208-2" title="2"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">stickersgiven =</span> <span class="st">&#39;absolutenumberofstickersgiven(Conditions1or3:Outof12;Conditions2or4:Outof30)&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb208-3" title="3"><span class="st">  </span>janitor<span class="op">::</span><span class="kw">clean_names</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb208-4" title="4"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>(), </a>
<a class="sourceLine" id="cb208-5" title="5">               <span class="dt">names_to =</span> <span class="st">&quot;variable_name&quot;</span>, </a>
<a class="sourceLine" id="cb208-6" title="6">               <span class="dt">values_to =</span> <span class="st">&quot;variable_description&quot;</span>)</a>
<a class="sourceLine" id="cb208-7" title="7"></a>
<a class="sourceLine" id="cb208-8" title="8">sticker_dict</a>
<a class="sourceLine" id="cb208-9" title="9"><span class="co">#&gt; # A tibble: 18 x 2</span></a>
<a class="sourceLine" id="cb208-10" title="10"><span class="co">#&gt;   variable_name    variable_description          </span></a>
<a class="sourceLine" id="cb208-11" title="11"><span class="co">#&gt;   &lt;chr&gt;            &lt;chr&gt;                         </span></a>
<a class="sourceLine" id="cb208-12" title="12"><span class="co">#&gt; 1 subject_number   [Included Sample Only]        </span></a>
<a class="sourceLine" id="cb208-13" title="13"><span class="co">#&gt; 2 condition        1=12:1; 2=12:2, 3=30:1, 4=30:2</span></a>
<a class="sourceLine" id="cb208-14" title="14"><span class="co">#&gt; 3 number_stickers  1=12; 2=30                    </span></a>
<a class="sourceLine" id="cb208-15" title="15"><span class="co">#&gt; 4 number_envelopes 1=1 recipient; 2=2 recipients </span></a>
<a class="sourceLine" id="cb208-16" title="16"><span class="co">#&gt; 5 gender           1=female; 2=male              </span></a>
<a class="sourceLine" id="cb208-17" title="17"><span class="co">#&gt; 6 agemonths        &lt;NA&gt;                          </span></a>
<a class="sourceLine" id="cb208-18" title="18"><span class="co">#&gt; # ... with 12 more rows</span></a></code></pre></div>
</div>
<div id="example-multi-row-headers" class="section level3">
<h3><span class="header-section-number">3.4.5</span> Example: multi-row headers</h3>
<p><a href="https://debruine.github.io/posts/multi-row-headers/" class="uri">https://debruine.github.io/posts/multi-row-headers/</a></p>
<p>In most cases, a header will only take up one row. And when multi-row headers present itself, <code>readr</code> fails to recognize all these rows as header</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb209-1" title="1"><span class="co"># create a small demo csv</span></a>
<a class="sourceLine" id="cb209-2" title="2">demo_csv &lt;-<span class="st"> &quot;SUB1, SUB1, SUB1, SUB1, SUB2, SUB2, SUB2, SUB2</span></a>
<a class="sourceLine" id="cb209-3" title="3"><span class="st">COND1, COND1, COND2, COND2, COND1, COND1, COND2, COND2</span></a>
<a class="sourceLine" id="cb209-4" title="4"><span class="st">X, Y, X, Y, X, Y, X, Y</span></a>
<a class="sourceLine" id="cb209-5" title="5"><span class="st">10, 15, 6, 2, 42, 4, 32, 5</span></a>
<a class="sourceLine" id="cb209-6" title="6"><span class="st">4, 43, 7, 34, 56, 43, 2, 33</span></a>
<a class="sourceLine" id="cb209-7" title="7"><span class="st">77, 12, 14, 75, 36, 85, 3, 2&quot;</span></a>
<a class="sourceLine" id="cb209-8" title="8"></a>
<a class="sourceLine" id="cb209-9" title="9"><span class="kw">read_csv</span>(demo_csv)</a>
<a class="sourceLine" id="cb209-10" title="10"><span class="co">#&gt; Warning: Duplicated column names deduplicated: &#39;SUB1&#39; =&gt; &#39;SUB1_1&#39; [2], &#39;SUB1&#39;</span></a>
<a class="sourceLine" id="cb209-11" title="11"><span class="co">#&gt; =&gt; &#39;SUB1_2&#39; [3], &#39;SUB1&#39; =&gt; &#39;SUB1_3&#39; [4], &#39;SUB2&#39; =&gt; &#39;SUB2_1&#39; [6], &#39;SUB2&#39; =&gt;</span></a>
<a class="sourceLine" id="cb209-12" title="12"><span class="co">#&gt; &#39;SUB2_2&#39; [7], &#39;SUB2&#39; =&gt; &#39;SUB2_3&#39; [8]</span></a>
<a class="sourceLine" id="cb209-13" title="13"><span class="co">#&gt; # A tibble: 5 x 8</span></a>
<a class="sourceLine" id="cb209-14" title="14"><span class="co">#&gt;   SUB1  SUB1_1 SUB1_2 SUB1_3 SUB2  SUB2_1 SUB2_2 SUB2_3</span></a>
<a class="sourceLine" id="cb209-15" title="15"><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt; </span></a>
<a class="sourceLine" id="cb209-16" title="16"><span class="co">#&gt; 1 COND1 COND1  COND2  COND2  COND1 COND1  COND2  COND2 </span></a>
<a class="sourceLine" id="cb209-17" title="17"><span class="co">#&gt; 2 X     Y      X      Y      X     Y      X      Y     </span></a>
<a class="sourceLine" id="cb209-18" title="18"><span class="co">#&gt; 3 10    15     6      2      42    4      32     5     </span></a>
<a class="sourceLine" id="cb209-19" title="19"><span class="co">#&gt; 4 4     43     7      34     56    43     2      33    </span></a>
<a class="sourceLine" id="cb209-20" title="20"><span class="co">#&gt; 5 77    12     14     75     36    85     3      2</span></a></code></pre></div>
<p>In <code>demo_csv</code>, the first three rows are intended to be an “overall” header. <code>read_csv()</code> outputs a message and modifes the first row for a unqiue set of column names, since it assumes this is a one-row header.</p>
<p>Based on what we have learned in the previous example, the solution should be easy. First set <code>n_max</code> to gain rows of interest, then compose a one-row header to set column names.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb210-1" title="1">demo_names &lt;-<span class="st"> </span><span class="kw">read_csv</span>(demo_csv, </a>
<a class="sourceLine" id="cb210-2" title="2">                       <span class="dt">n_max =</span> <span class="dv">3</span>, </a>
<a class="sourceLine" id="cb210-3" title="3">                       <span class="dt">col_names =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb210-4" title="4"><span class="st">  </span><span class="kw">map_chr</span>(<span class="op">~</span><span class="st"> </span><span class="kw">str_c</span>(.x, <span class="dt">collapse =</span> <span class="st">&quot;&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb210-5" title="5"><span class="st">  </span><span class="kw">unname</span>()</a>
<a class="sourceLine" id="cb210-6" title="6"></a>
<a class="sourceLine" id="cb210-7" title="7">demo_names  </a>
<a class="sourceLine" id="cb210-8" title="8"><span class="co">#&gt; [1] &quot;SUB1COND1X&quot; &quot;SUB1COND1Y&quot; &quot;SUB1COND2X&quot; &quot;SUB1COND2Y&quot; &quot;SUB2COND1X&quot;</span></a>
<a class="sourceLine" id="cb210-9" title="9"><span class="co">#&gt; [6] &quot;SUB2COND1Y&quot; &quot;SUB2COND2X&quot; &quot;SUB2COND2Y&quot;</span></a>
<a class="sourceLine" id="cb210-10" title="10"></a>
<a class="sourceLine" id="cb210-11" title="11"><span class="kw">read_csv</span>(demo_csv, <span class="dt">col_names =</span> demo_names, <span class="dt">skip =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb210-12" title="12"><span class="co">#&gt; # A tibble: 3 x 8</span></a>
<a class="sourceLine" id="cb210-13" title="13"><span class="co">#&gt;   SUB1COND1X SUB1COND1Y SUB1COND2X SUB1COND2Y SUB2COND1X SUB2COND1Y SUB2COND2X</span></a>
<a class="sourceLine" id="cb210-14" title="14"><span class="co">#&gt;        &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb210-15" title="15"><span class="co">#&gt; 1         10         15          6          2         42          4         32</span></a>
<a class="sourceLine" id="cb210-16" title="16"><span class="co">#&gt; 2          4         43          7         34         56         43          2</span></a>
<a class="sourceLine" id="cb210-17" title="17"><span class="co">#&gt; 3         77         12         14         75         36         85          3</span></a>
<a class="sourceLine" id="cb210-18" title="18"><span class="co">#&gt; # ... with 1 more variable: SUB2COND2Y &lt;dbl&gt;</span></a></code></pre></div>
<p>For reading multi-row headers in Excel, check section <a href="readxl.html#multi-row-headers-in-excel">3.5.1</a></p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="parsing-a-vector.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="readxl.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/enixam/rfordatascience/edit/master/readr.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
